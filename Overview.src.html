<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>CSS Books</title>
<style>
.head h1 { padding: 1em 0 }
span.minor { letter-spacing: 0; color: black; font-size: 0.8em; font-weight: normal }

.code-example { position: relative; color: black; background: #ddeeff; font-style: italic; margin-left: 2em; padding-left: 2em; }
.code-example::before { content: 'Test'; background: #008; color: white; padding: 0.15em 0.25em; font-style: normal; position: absolute; top: -0.2em; left: -1.5em; transform: rotate(-5deg); }

a { text-decoration: none }
a.pass { color: green }
a.fail { color: red }
a.unclear, a.almost { color: orange }
.issue { background: #FAA; padding: 0.2em 0.4em; margin: 0.3em 0 }
.issue::before { content: "Issue: " }
</style>
<link rel="stylesheet" type="text/css" href="https://resources.whatwg.org/standard.css">

<body class="draft">
<div class="head">
  <p><a class="logo" href="https://whatwg.org/"><img alt="WHATWG" height="100" src="https://resources.whatwg.org/logo.svg" width="100"></a></p>
	<h1>[TITLE]</h1>

	<h2 class="no-num no-toc">Living Idea &mdash; Last Updated [DATE]</h2>

	<dl>
		<dt>This version:
		<dd><!--begin-link-->https://books.idea.whatwg.org/<!--end-link-->


		<dt>Editor:
		<dd class="vcard">
			<span class="fn">H&aring;kon Wium Lie</span>,
			<span class="org">Opera Software</span>,
			<span class="email">howcome@opera.com</span>

		<dt>Participate:</dt>
		<dd><a href="https://whatwg.org/mailing-list">whatwg@whatwg.org</a></dd>
		<dd><a href="https://lists.w3.org/Archives/Public/www-style/">www-style@w3.org</a></dd>

<dd><a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WHATWG&amp;component=Books">file a bug</a> (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WHATWG&amp;component=Books&amp;resolution=---">open bugs</a>)</dd>


	</dl>

<p class="copyright"><a href="https://creativecommons.org/publicdomain/zero/1.0/" rel="license"><img alt="CC0" src="https://i.creativecommons.org/p/zero/1.0/80x15.png"></a>To the extent possible under law, the editor has waived all copyright and related or neighboring rights to this work. In addition, as of [DATE], the editor has made this specification available under the
<a href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0" rel="license">Open Web Foundation Agreement Version 1.0</a>, which is available at <!--begin-link-->http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0<!--end-link-->.

</div>

<h2 class="no-num no-toc">Abstract</h2>

<p>This specification defines features often used when printing books or magazines. Using this functionality, documents written in HTML can be presented in a book-like manner, either on screen or on paper. Real books are being published with functionality described in this specification.

<h2 class="no-num no-toc">Status</h2>

<p>This specification is in the process of establishing itself in WHATWG. Most of this specification has been interoperably implemented and is in daily use by publishers. Implementation coverage is <a href="http://www.wiumlie.no/2014/tests/books/coverage.html">documented here</a>.

<h2 class="no-num no-toc">Table of Contents</h2>

<!--toc-->


<h2 class="no-num">Goals</h2>

<p>The main goal of this specification is to enable authors to write books in HTML or other markup languages. Book publishing is a craft with long traditions and certain formatting conventions have developed over time. This specification adds functionality to CSS so that style sheets can express commonly used features in printed books, on-screen books, and page description languages. These features are also often used by magazines, in brochures, and in other publications.


<h2>Conformance</h2>

<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this specification are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<span data-anolis-ref>RFC2119</span>

<p>Conformance requirements phrased as algorithms or specific steps
may be implemented in any manner, so long as the end result is
equivalent.

<p id="hardwareLimitations">User agents may impose
implementation-specific limits on otherwise unconstrained inputs,
e.g. to prevent denial of service attacks, to guard against running
out of memory, or to work around platform-specific limitations.


<h2>Introduction</h2>

<p>A book is a collection of sheets, bound together within covers.
Usually, the sheets are printed paper sheets of a uniform size. The
book format, known as the <em>codex</em> was developed around 2000
years ago and books gradually replaced scrolls, clay tablets and other
competing formats. With the invention of the printing press, books
could be printed and distributed inexpesively.

<p>Each sheet of paper has two sides, and most books are have content
on both sides of the sheets. Each side is called a "page". When a book
is opened, two pages are visible; these form one "spread". The main
problem when producing books from web content is to split content into
pages and spreads of certain fixed sizes. This problem is not
addressed by this specification. Instead, this specification describes
how to achieve many of the features printers have developed over the
centuries, e.g, running headers, footnotes, sidenotes, and page
groups.


<h2>Running headers and footers</h2>

<p>To aid navigation in printed material, headers and footers are often
printed in the page margins. <span data-anolis-ref>CSSPAGE</span> describes how to place
headers and footers on a page, but not how to fetch headers and
footers from elements in the document. This specification offers two
ways to achieve this. The first mechanism is <dfn>named strings</dfn>
which <em>copies</em> the text (without style, structure, or replaced
content) of an element for later reuse in margin boxes. The second
mechanism is <dfn>running elements</dfn> which <em>moves</em> elements
(with style, structure, and replaced content) into a margin box.



<h3>Named strings</h3>

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/named-strings.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/named-strings-ah.pdf">AntennaHouse</a>
<a class=almost href="http://www.wiumlie.no/2014/tests/books/named-strings-pr.pdf">Prince</a>
</div>


<!--
<p>Named strings are discussed both in the CSS3 Generated and Replaced
Content (section 9) and in CSS3 Paged Media (several places). For a
proposed definition of the property, one has to go back to the <a href="http://www.w3.org/1999/06/WD-css3-page-19990623">CSS3 draft from 1999</a>
1999:
-->

<p>A named string can be thought of as a variable that hold a
string of text. Named strings are created with the 'string-set'
property which copies a string of text into a named string. Only text
is copied; not style, structure, or replaced content.

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/e-string-set-motivational.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-string-set-motivational-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-string-set-motivational-pr.pdf">Prince</a>
</div>

<div class="example">

<p>Consider this code:

<pre>
h1 { string-set: heading content() }
</pre>

<p>Whenever an <code>h1</code> element is encountered,
its textual content is copied into a named string called
<em>heading</em>. The string can later be retrieved in the 'content'
property:

<pre>
@page { @top-center { content: string(heading) }}
</pre>

</div>


<h4>Setting named strings: the 'string-set' property</h4>

<table class=propdef>
    <tr>
      <td><em>Name:</em>
      <td><dfn>string-set</dfn>
    <tr>
      <td><em>Value:</em>
      <td>[[ &lt;identifier> &lt;content-list>] [, &lt;identifier> &lt;content-list>]* ] | none
    <tr>
      <td><em>Initial:</em>
      <td>none
    <tr>
      <td><em>Applies to:</em>
      <td>all elements
    <tr>
      <td><em>Inherited:</em>
      <td>no
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Media:</em>
      <td>all
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>as specified value
</table>

<p>The 'string-set' property accepts a comma-separated list of named strings. Each named string is followed by a content list that specifies the text to assign to the named string. Whenever an element with value of 'string-set' different from ''none'' is encountered, the named strings are assigned their respective value. Implementations must keep track of named string assigments on a per-element basis; references to named strings can only be resolved after pagination (see <a href="#using-named-strings">Using named strings</a> below).

<p name=content-list>&lt;content-list> expands to one or more of these values, in any order:

<dl>

<dt>&lt;string&gt;
<dd>a string, e.g. "foo"

<dt>&lt;counter&gt;
<dd>the counter() or counters() function, as per <a href="http://www.w3.org/TR/CSS21/syndata.html#counter">CSS 2.1 section 4.3.5</a> <span data-anolis-ref>CSS</span>

<dt>content(text)

<dd>The textual content of the element, not including the content of its ::before and ::after pseudo-element. The content of the element's descendants, including their respective ::before and ::after pseudo-elements, are included in the returned content. This is the default value, so ''content()'' is equivalent to ''content(text)''.

<dt>content(before)

<dd>The textual content of the ::before pseudo-element of the element.

<dt>content(after)

<dd>The textual content of the ::after pseudo-element of the element.

<dt>content(first-letter)

<dd>The first letter of the textual content of the element. The definition of a letter is the same as for the :first-letter pseudo-element, as per <a href="http://www.w3.org/TR/CSS2/selector.html#first-letter">CSS 2.1 section 5.12.2</a>.

</dl>

<p>The syntax is formally described as:

<pre>
  &lt;content-list&gt; = [ &lt;string&gt; | &lt;counter&gt; | [ content( [ before | after | first-letter ] ) ] ]+
</pre>

<p>Named strings can only hold the result of one assignment; whenever
a new assignment is made to a named string, its old value is replaced.

<p class='note'>User agents, however, must be able to remember the
several assignments as the ''string()'' functional value
(described below) can refer to different assignments.

<p>The scope of a named string is the page of the element to which the
'string-set' property is attached and subsequent pages.

<!--
<p>The name space of named strings is different from other sets of
names in CSS.
-->


<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/e-string-set-counter.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-string-set-counter-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-string-set-counter-pr.pdf">Prince</a>
</div>


<div class="example">
<pre>
h2 {
  string-set: header "Chapter " counter(header) ": " content();
  counter-increment: header;
}

&lt;h2>Europa&lt;/h2>
</pre>

<p>Note that the string called "header" is different from the counter with the same name. The above code may result in the string called "header" is set to "Chapter 1: Europa".

</div>


<p>The textual content of the named string is processed as if 'white-space: normal' has been set.

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/e-string-set-white-space.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-string-set-white-space-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/string-set-set-white-space-pr.pdf">Prince</a>
</div>

<div class="example">
<p>In this example, the header will consist of three words ("In the beginning") with normal spacing between the words.
<pre>
h2 {
  string-set: header "In " ' ' content();
}

&lt;h2>   the    beginning&lt;/h2>
</pre>
</div>


<div class="example">
<p>In this example, the named string called <em>index</em> will hold the first letter of &lt;dt&gt; elements.
<pre>
dt { string-set: index content(first-letter) }
</pre>
<p>One-letter running headers are often used in dictionaries.
</div>

<p>The textual content is copied regardless of values on other CSS properties.

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/e-string-set-other-declarations.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-string-set-other-declarations-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-string-set-other-declarations-pr.pdf">Prince</a>
</div>

<div class="example">
<p>In this example, the first four declarations have no effect on the on the named string copied in the last declaration:

<pre>
title {
  display: none;
  content: "foo";
  text-transform: uppercase;
  text-replace: "foo" "bar";
  string-set: title content();
}
</pre>
</div>


<h4>Using named strings</h4>

<p>Named strings can be referred to with the ''string()'' value on the
'content' property. The ''string()'' value has one required argument
(the name of the string), and one optional argument that indicates
which string assignment to use. References to named strings can only
be resolved after pagination.

<div class="example">
<pre>
@page { @top-center { content: string(header) }}
@page { @right-middle { content: string(index) }}
@page { @top-left { content: string(entry) }}
h1 { string-set: header "Chapter " counter(chapter) content() }
dt { string-set: index content(first-letter), entry content() }
</pre>
<!--h1 { string-set: header "Chapter " counter(chapter) contents }
dt { string-set: index content-first-letter, entry contents }-->

</div>

<p>If the value of the named string is changed by an element on a certain
page, the named string may have several values on that page. In order to specify
which of these values should be used, an optional second argument is accepted
on the ''string()'' value. This argument can have one of four keywords:

<ul>
<li>''first'': the value of the first assignment on the page is used. If there is no assignment on the page, the named string's entry value is used. The entry value is the value held by the string at the end of the previous page. ''first'' is the default value.

<li>''start'': the value of the first assignment on the page is used if the element begins the page or the named string has not been assigned a value. Otherwise, the named string's entry value is used.

<li>''last'': the named string's exit value is used

<li>''first-except'': similar to ''first'', except on the page where the value was assigned. On that page, the empty string is used.

</ul>

<p>The syntax of the ''string()'' value is:

<pre>
  string( <a href="http://www.w3.org/TR/css3-values/#custom-idents">&lt;custom-ident&gt;</a> [ , [ first | start | last | first-except ]]? )
</pre>

<p>The assignment is considered to take place on the first page where a content box representing the element occurs. If the element does not have any content boxes (e.g., if 'display: none' is set), the assignment is considered to take place on the page where the first content box would have occured if the element had been in the normal flow.

<div class="example">
<p>In this example, the first term on the page will be shown in the top left corner and the last term on the page will be shown in the top right corner. In top center of the page, the first letter of first term will be shown.
<pre>
@page { @top-left { content: string(term, first) }}
@page { @top-right { content: string(term, last) }}
@page { @top-center { content: string(index, first) }}
dt { string-set: index content(first-letter), term content(text) }
</pre>
</div>

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/string-set-continents.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/string-set-continents-ah.pdf">AntennaHouse</a>
<a class=almost href="http://www.wiumlie.no/2014/tests/books/string-set-continents-pr.pdf">Prince</a>
</div>


<div class="example">

<p>Given this CSS code:

<pre>
h2 { string-set: header content() }
</pre>

<p>The value of the <em>header</em> string

<table class=string-set-example>
<tr>
<td>page#<td>HTML code<td>first<td>start<td>last<td>first-except

<tr>
<td>1
<td>
<pre>&lt;h1>Continents&lt;/h1>
...
&lt;h2>Africa&lt;/h2>
...
...
</pre>
<td>Africa
<td>Africa
<td>Africa
<td>


<tr>
<td>2
<td>
<pre>...
&lt;h2>Americas&lt;/h2>
...
&lt;h2>Asia&lt;/h2>
...
</pre>
<td>Americas
<td>Africa
<td>Asia
<td>


<tr>
<td>3
<td>
<pre>...
...
...
...
</pre>
<td>Asia
<td>Asia
<td>Asia
<td>Asia

<tr>
<td>4
<td>
<pre>&lt;h2>Europe&lt;/h2>
...
&lt;h2>Oceania&lt;/h2>
..

</pre>
<td>Europe
<td>Europe
<td>Oceania
<td>
</table>

</div>


<div class="example">
<p>In this example, the term that is being described at the start of the page is shown in the top left header.
<pre>
@page { @top-left { content: string(term, start) }}
dt { string-set: term content() }
</pre>
</div>

<div class="example">
<pre>
@page { @top-left { content: string(term, first) }}
@page { @top-right { content: string(term, last) }}
@page { @top-center { content: string(index, first) }}
dt { string-set: index content(first-letter), term content(text) }
</pre>
</div>



<div class="example">
<p>In this example, the header in the top center will be blank on pages where 'h1' elements appear. On other pages, the string of the previous 'h1' element will be shown.
<pre>
@page { @top-center { content: string(chapter, first-except) }}
h1 { string-set: chapter content() }
</pre>
</div>

<p>If the named string referred to in a 'string()' value has not been
assigned a value, the empty string is used.


<h3>Running elements</h3>

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/running-elements.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/running-elements-ah.pdf">AntennaHouse</a>
<a class=almost href="http://www.wiumlie.no/2014/tests/books/running-elements-pr.pdf">Prince</a>
</div>


<p>Named strings, as described above, can only hold textual content; any
style, structure or replaced content associated with the element is
ignored. To overcome this limitation, a way of moving elements into
running headers and footers is introduced.

<p>Elements that are moved into headers and footers are repeated on
several pages; they are said to be <em>running elements</em>. To
support running elements, a new value &ndash; running() &ndash; is
introduced on the 'position' property. It has one required argument:
the name by which the running element can be referred to. A running
element is not shown in its natural place; there it is treated as if
'display: none' had been set. Instead, the running element is
displayed when referred to by the ''element()'' value.

<p>Like counters and named strings, the name of a running element is chosen by
the style sheet author, and the names have a separate namespace. A
running element can hold one element, including its pseudo-elements
and its descendants. Whenever a new element is assigned to a running
element, the old element is lost.

<p class='note'>User agents, however, must be able to remember the
result of more than one assignment as the ''element()'' value
(described below) can refer to different assignments.

<p>Running elements inherit through their normal place in the
structure of the document.


<div class="example">
<pre>
title { position: running(header) }
@page { @top-center {
  content: element(header) }
}
</pre>
</div>

<!--
<div class="example remove">
<p>In this example, the element is copied into the running header but it also keeps its normal place.

<pre>
title { position: running(header), normal }
@page { @top-center {
  content: element(header) }
}
</pre>
</div>
-->


<p>Like the ''string()'' value, the ''element()'' value accepts an
optional second argument. The syntax is defined as:

<pre>
  element( <a href="http://www.w3.org/TR/css3-values/#custom-idents">&lt;custom-ident&gt;</a> [ , [ first | start | last | first-except ]]? )
</pre>

<p>The keywords have the same meaning as for the ''string()'' value.

<p>The ''element()'' value is only allowed on the 'content' property within a margin box. The ''element()'' value cannot be combined with any other values.

<div class="example">
<p>In this example, the header is hidden from view in all media types
except print. On printed pages, the header is displayed top center on
all pages, except where h1 elements appear.

<pre>
&lt;style>
  div.header { display: none }
  @media print {
  div.header {
    display: block;
    position: running(header);
  }
  @page { @top-center { content: element(header, first-except) }}
&lt;/style>
...
&lt;div class="header">Introduction&lt;/div>
&lt;h1 class="chapter">An introduction&lt;/div>

</pre>
</div>

<div class="example">
<p>This code illustrates how to change the running header on one page in the middle of a run of pages:

<pre>
...
&lt;style>
@page { @top-center {
  content: element(header, first) }}
.header { position: running(header) }
.once { font-weight: bold }
&lt;/style>
...
&lt;div class="header">Not now&lt;/div>
&lt;p>Da di ha di da di ...
  &lt;span class="header once">NOW!&lt;/span>
  &lt;span class="header">Not now&lt;/span>
  ... da di ha di hum.&lt;/p>
...
</pre>

The header is "Not now" from the outset, due to the "div" element. The
first "span" element changes it to "<b>NOW!</b>" on the page where the
"span" element would have appeared. The second "span" element, which
would have appeared on the same page as the first is not used because the
''first'' keyword has been specified. However, the second "span"
element still sets the exit value for "header" and this value is
used on subsequent pages.
</div>



<h2>Leaders</h2>

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/leaders.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/leaders-ah.pdf">AntennaHouse</a>
<a class=almost href="http://www.wiumlie.no/2014/tests/books/leaders-pr.pdf">Prince</a>
</div>


<p>A leader is a visual pattern that guides the eye. Typically,
leaders are used to visually connect an entry in a list with a
corresponding code. For example, there are often leaders between
titles and page numbers in a table of contents (TOC). Another example
is the phone book where there are leaders between a name and a
telephone number.

<p>In CSS3, a leader is composed of series of glyphs through the
''leader()'' value on the 'content' property. The functional notation
accepts two values. The first describes the glyph pattern that makes up the
leader. The syntax is:

<pre>
  leader( [ dotted | solid | space |  <a href="http://www.w3.org/TR/css3-values/#strings">&lt;string&gt;</a> ] )
</pre>

<p>Using the keyword values is equivalent to setting a string value.
The table below shows the equivalents:

<table class=border>
<tr><th>Keyword<th>String<th>Unicode characters
<tr><td>leader(dotted)<td>leader('. ')<td>\002E \0020
<tr><td>leader(solid)<td>leader('_')<td>\005F
<tr><td>leader(space)<td>leader(' ')<td>\0020
</table>


<p>The string inside the parenthesis is called the <dfn>leader
string</dfn>. The leader string must be shown in full at least once,
thereby pushing other content to the side (in the writing direction of
the element to which the leader is attached). The leader string
establishes the minimum length of the leader. If there is empty space
on the line, the leader is expanded by repeating it as many times as
possible. The expansion of a leader from its minimum length never
causes line breaks to change. At the end of the leader, a partial
leader string may be shown.

<p>Line-breaking characters inside leader strings must be ignored. A list of line-breaking characters are found in
<a href="http://www.unicode.org/standard/reports/tr13/tr13-5.html">[Unicode
Technical Report #13]</a>. Other white space characters are collapsed according to the values of
white-space properties. A leader consisting only of whitespace
characters is called a <dfn>whitespace leader</dfn>.


<p>To determine the length of the leaders, user agents must do the
following for each line where a leader appears:

<ol>
<li>Lay out the content with leaders of minimum lengths.

<li>Determine the empty space on the line. The empty space is the difference between the width of the line box (as per <a href="http://www.w3.org/TR/CSS2/visuren.html#line-box">CSS 2.1, section 9.4.2</a>) and the formatted content in the line box. For table cells in automatic table layout, leaders may influence the layout by enlarging the "maximum cell width" (as per <a href="http://www.w3.org/TR/CSS2/tables.html#auto-table-layout">CSS 2.1 17.5.2.2</a>).

<li>Distribute the empty space between all leaders on the line and
fill the empty space with the specified leader patterns. Glyphs must
not be shown partially. All leaders on the line should, to the extent
possible, have the same length. This may not always be possible as the
minimum leader length must be honored.

</ol>


<div class="example">
<p>By adding a leader to the ::after pseudo-element, a leader is added after the content of an element:
<pre>
h1::after { content: leader(dotted) }

&lt;h1>Dotted news&lt;/h1>
</pre>
<p>The formatted result may be:
<pre>
|Dotted news...................|
</pre>
</div>

<div class="example">
<p>By setting 'white-space: pre', the white space in the leader string is preserved:
<pre>
h1::after {
  content: leader('  -  ');
  white-space: pre;
}
&lt;h1>Dashing news&lt;/h1>
</pre>
<p>The formatted result may be:
<pre>
|Dashing news  -    -    -    -|
</pre>
</div>

<div class="example">

<p>If a leader is set on an inline element inside a justified paragraph, there will not be any empty space on the line. Therefore, the leader is shown only once.

<pre>
span::after {
  content: leader('...');
}

&lt;p>A paragraph with a &ltspan>span&lt;/span> inside.
</pre>

would be formatted as:

<pre>
A paragraph with a span... inside.
</pre>

</div>




<div class="example">
<p>The presence of a leader may influence tables. Consider this example with two table cells in one row:

<pre>
td.leader::after { content: leader('..') }

&lt;table style="width: 30em">
&lt;tr>&lt;td class=leader>foo&lt;/td> &lt;td>bar&lt;/td>&lt;/tr>
&lt;/table>
</pre>

<p>In UAs that don't do leaders, the two cells will have the same width
and the table cells could be rendered like this:

<pre>
|foo                             |bar                           |
</pre>

<p>When leaders are supported, the <em>maximum cell width</em> of the
first cell grows, and the table cell could be rendered like this:

<pre>
|foo........................................................|bar|
</pre>

<!--<p>(The '|' charaters mark vertical cell edges in the figures above.)-->
</div>

<div class="example">

<p>A table of contents often use leaders to visually connect a chapter
title with the corresponding page number. This can be achieved with code like:

<pre>
ul.toc a::after {
  content: leader(". . . ") target-counter(attr(href url), page);
}
</pre>

<p>The formatted result could be:

<pre>
Africa ...........1
America...........9
Antarctica.......56
Asia............134
</pre>

</div>

<p>The appearance of leaders is influenced by the same set of properties that influence the appearance of fixed strings.

<div class="example">
<p>The same properties can affect the presentation of the fixed string and the leader.

<pre>
content: "...";
content: leader("...");
</pre>
</div>

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/e-leaders-line-numbers.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-leaders-line-numbers-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-leaders-line-numbers-pr.pdf">Prince</a>
</div>


<div class="example">
<p>Line numbers sometimes displayed on the side of poetry, for reference purposes. In this example, a counter is dsplayed on every other line and pushed to the right by an invisible leader.

<pre>
@page { counter-reset: line }
.line { counter-increment: line }
.line:nth-of-type(2n+1)::after { content: leader(space) counter(line) }
</pre>

<p>The formatted result could be:

<pre>
Oh! let that eye, which, wild as the gazelle's,    1
Now brightly bold or beautifully shy,
Wins as it wanders, dazzles where it dwells,       3
Glance o'er this page, nor to my verse deny
</pre>

<p>Note that the formatter doesn't really count lines, but rather elements marked up as lines.
</div>

<!--
<p>If the presence of a minimum length leader at the end of a line results in subsequent content being moved to the next line, the leader will also appear at the beginning of the next line.
-->

<p>A leader is only present on one line. If the presence of a minimum length leader at the end of a line results in subsequent content being moved to the next line, the leader will also be moved to the next line.

<div class="example">
<p>Consider this code:

<pre>
&lt;style>
.name::after { content: leader("...") }
&lt;/style>
&lt;div class="entry">
&lt;span class="name">Douglas Adams&lt;/span>
&lt;span class="number">43&lt;/span>
&lt;/div>
</pre>

<p>Depending on the width of the containing block, the content may or may not fit on one line. In the rendered examples below, the thrird rendition the leader and its subsequent content is moved to the second line.

<pre>
|Douglas Adams......42|
</pre>

<pre>
|Douglas Adams...42|
</pre>

<pre>
|Douglas Adams   |
|..............42|
</pre>

</div>

<p>The purpose of a leader is most often to connect two
strings visually. To achieve this, User Agents may chose to move
content appearing before the leader onto the same line as the leader.

<div class="example">
<p>In this renditon, the User Agen has chosen to move "Adams" to the next line to preserve a visual connection:

<pre>
|Douglas         |
|Adams.........42|
</pre>
</div>


<div class="example">
<p>In cases where there is not enough space for content on both sides of the leader, the leader will remain on the same line as the following content.

<pre>
|Douglas  |
|Adams    |
|.......42|
</pre>

<pre>
|Dou|glas
|Ada|ms
|...|42
</pre>
</div>

<div class=example>
<p>In this example, a whitespace leader is placed before a &lt;cite> element:

<pre>
&lt;style>
cite::before { content: leader('  ') }
&lt;/style>
&lt;blockquote>
  For a moment, nothing happend.
  Then, after a second or so,
  nothing continued to happen.
    &lt;cite>Douglas&nbsp;Adams&lt;/cite>
&lt;/blockquote>
</pre>

<p>Whitespace leaders do not connect two strings in the same way that visible leaders do. User Agents may therefore chose to not move content appearing before the leader onto the same line as the leader. This may result in a rendition like:

<pre>
|For a moment, nothing happend.  |
|Then, after a second or so,     |
|nothing continued to happen.    |
|                   Douglas Adams|
</pre>

<p>Rather than:

<pre>
|For a moment, nothing happend.  |
|Then, after a second or so,     |
|nothing continued to            |
|happen.            Douglas Adams|
</pre>

</div>

<!--
<div class="example">
<p>Consider this code:

<pre>
&lt;style>
cite::before { content: leader('  ') }
&lt;/style>
&lt;blockquote>
  For a moment, nothing happend.
  Then, after a second or so,
  nothing continued to happen.
    &lt;cite>Douglas&nbsp;Adams&lt;/cite>
&lt;/blockquote>
</pre>

<p>Depending on the width of the containing block, this may be rendered as:

<pre>
 |For a moment, nothing happend.  |
 |Then, after a second or so,     |
 |nothing continued to happen.    |
 |                   Douglas Adams|
</pre>


<p>If the containing block is wider, this may be the resultant presentation:

<pre>
 |For a moment, nothing happend. Then,    |
 |after a second or so, nothing continued |
 |to happen.                 Douglas Adams|
</pre>

</div>
-->

<p>When possible, User Agents should align corresponding glyphs from the
leaders of consecutive lines.

<div class=example>
<p>In this example, the dotted lines are aligned horizontally so that the dots appear directly above and below each other:
<pre>
  Alfa ........ 5
  Bravo ...... 41
  Charlie ... 125
<pre>
</div>



<h2>Cross-references</h2>

<p>It is common to refer to other parts of a document by way of a
section number (e.g., "See section 3.4.1"), a page number (e.g., "See
discussion on page 72"), or a string (e.g., "See the chapter on
Europe"). This specification describes how to resolve cross-references
automatically by introducing two new values on the 'content' property.

<h3>The ''target-counter'' and ''target-counters'' values</h3>

<p>Numerical cross-references are generated by ''target-counter()''
and ''target-counters()'' values on the 'content' property that fetch the value of a counter at
the target end of the link. These functions are similar to the
''counter()'' and ''counters()'' functions, except that they fetch
counter values from remote elements. ''target-counter()'' has two
required arguments: the url of the link, and the name of a counter.
''target-counters()'' has three required arguments: the url of the
link, the name of a counter, and a separator string. Both functions
accepts an optional argument at the end that describes which list
style type to use when presenting the resulting number; ''decimal''
being the default. The syntax is defined as:

<pre>
  target-counter( <a href="http://www.w3.org/TR/css3-values/#url-value">&lturl&gt;</a> , <a href="http://www.w3.org/TR/css3-values/#custom-idents">&lt;custom-ident&gt;</a> [ , <a href="http://www.w3.org/TR/CSS21/generate.html#propdef-list-style-type">&lt;counter-style&gt;</a> ]? )
  target-counters( <a href="http://www.w3.org/TR/css3-values/#url-value">&lturl&gt;</a> , <a href="http://www.w3.org/TR/css3-values/#custom-idents">&lt;custom-ident&gt;</a> , <a href="http://www.w3.org/TR/css3-values/#strings">&lt;string&gt;</a> [ , <a href=http://www.w3.org/TR/CSS21/generate.html#propdef-list-style-type>&lt;counter-style&gt;</a> ]? )
</pre>


<div class="example">
<p>This style sheet specifies that a string like " (see page 72)"
is added after a link:

<pre>
a::after { content: "(see page " target-counter(attr(href url), page, decimal) ")" }
</pre>
</div>

<!--
<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/target-counters.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/target-counters-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/target-counters-pr.pdf">Prince</a>
</div>
-->

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/target-counters-section.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/target-counters-section-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/target-counters-section-pr.pdf">Prince</a>
</div>


<div class="example">
<p>This style sheet specifies that a string like " (see section 1.3.5)"
is added after a link:

<pre>
a::after { content: "(see section " target-counters(attr(href url), section, ".", decimal) ")" }
</pre>

</div>

<h3>The ''target-text'' value</h3>

<p>Textual cross-references are generated by ''target-text()'' which
fetches the textual content from the target end of the link. Only text
is copied; not style, structure, or replaced content.
''target-text()'' has one required argument: the url of the link. An
optional second argument specifies exactly which content is fetched.
There are four possible values: ''content'', ''before'', ''after'',
''first-letter''; these keywords are defined on 'string-set' above. The syntax is:

<pre>
  target-text( <a href="http://www.w3.org/TR/css3-values/#url-value">&lturl&gt;</a> [, [ content | before | after | first-letter ]]? )
</pre>


<div class="example">
<p>To generate this text:

<blockquote>
<p>See Chapter 3 ("A better way") on page 31 for an in-depth evaluation.
</blockquote>

from this markup:

<pre>
&lt;p>See &lt;a href="#chx">this chapter&lt;/a> for an in-depth evaluation.
...
&lt;h2 id="chx">A better way&lt;/h2>
</pre>

this CSS code can be used:

<pre>
h2 { counter-increment: chapter }
a { content: "Chapter " target-counter(attr(href url), chapter)
   ' ("'  target-text(attr(href url), content) '") on page '
   target-counter(attr(href url), page);
</pre>
</div>


<h2>Footnotes</h2>


<div class=code-example>
<a href="http://www.wiumlie.no/2015/tests/books/footnotes.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/footnotes-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2015/tests/books/footnotes-pr.pdf">Prince</a>
</div>


<p>When an element is turned into a footnote, certain things
happen: the element is moved to the footnote area, a footnote call is
left behind in its place, a footnote marker is displayed before the
element, and the footnote counter is incremented.

<p>A footnote is a note typically placed at the bottom of a page that
comments on, or cites, a reference. References to footnotes are marked
with a <em>footnote call</em> in the main text which corresponds to
a <em>footnote marker</em> in the <em>footnote area</em>. The
rendering of footnotes is complex. As far as possible, footnotes try
to reuse other parts of CSS. However, due to the typographic
traditions of footnotes, some new functionality is required.

<!--
 to support
footnotes in CSS.

<ul>
<li>one new value on the 'float' property: ''footnote''
<li>one new page area: ''@footnote''
<li>two new pseudo-elements: ''::footnote-call'' and ''::footnote-marker''
<li>one predefined counter: ''footnote''
<li>one new value on the 'content' property: ''target-pull()''
<li>border segments (see <a href="http://dev.w3.org/csswg/css-backgrounds-4/#border-clip">border-clip</a>)
<li><a href="http://www.w3.org/TR/2011/WD-css3-lists-20110524/#super-decimal">super-decimal</a>
<li>two new 'list-style-type' values: ''super-decimal'', and symbol(...)
</ul>
-->

<div class=example>
<p>In its simplest form, making a footnote is simple.

<pre>
&lt;style>
.footnote { float: footnote }
&lt;/style>

&lt;p>A sentence consists of words.&lt;span class="footnote">Most often.&lt;/span>.
</pre>

<p>In this example, the text <q>Most often.</q> will be placed in a
footnote. A note-call will be left behind in the main text and a
corresponding marker will be shown next to the footnote. Here is one
possible rendering:

<pre>
A sentence consists of words.&#xB9;

&#xB9; Most often.
</pre>
</div>

<div class=example>
<p>Footnotes make sense in paged media, but in continous media the information is better displayed inline. Here is an example of how to support both paged and contious media:

<pre>
&lt;style>
@media print {
.footnote { float: footnote }
}
@media screen {
.footnote::before { content: " (" }
.footnote::after { content: ")" }
}
&lt;/style>

&lt;p>A sentence consists of words.&lt;span class="footnote">Most often.&lt;/span>.
</pre>

<p>In contious media, the presentaion will be:

<pre>
A sentence consists of words. (Most often.)
</pre>
</div>



<!--
<div class="example remove">

<p>To support legacy browsers, it is often better to make a link to
the note rather than including the text inline. This example shows how
to fetch the content of a note and place it in a footnote.

<pre>
&lt;style>
@media print {
  .footnote {
    float: footnote;
    content: target-pull(attr(href url)) }
  .call { display: none }
}
&lt;/style>
...
&lt;p>A sentence consists of words&lt;a class="footnote" href="#words"> [3]&lt;/a>.
...
&lt;p id=words>&lt;span class="call">[3]&lt;/span> Most often.
</pre>

<p class=issue>define ''target-pull''

<p>When shown in a legacy browser, the content of the element will be
shown as a clickable link to an endnote. When printed according to
this specification, there will be a footnote:

<pre>
A sentence consists of words&#xB9;.

&#xB9; Most often.
</pre>
</div>

-->

<div class=example>

<p>Consider this markup:

<pre>
&lt;p>Sorry, &lt;span title="This is, of course, a lie.">we're closing for lunch&lt;/span>.
</pre>

<p>The content of the "title" attribute can be turned into a footnote with this code:

<pre>
span[title]::after {
  content: attr(title);
  float: footnote;
}
</pre>
</div>


<h3>Turning elements into footnotes</h3>

<p>An element with ''float: footnote'' (called a <em>footnote
element</em>) is moved to the <em>footnote area</em> and a <em>footnote-call</em>
pseudo-element is put in its original place.

<div class="example">
<pre>
span.footnote {
  float: footnote;
}
</pre>
</div>

<p>Footnote elements are presented inside the <em>footnote area</em>,
but they inherit through their normal place in the structure of the
document.

<!--
<div class=remove>
<p>The 'display' property on footnote elements is ignored. Instead,
the value of the 'display' property in the @footnote context
determines if footnotes are block or inline elements.

<div class="example">
<p>In this example, the footnotes are displayed inline:

<pre>
@footnote {
  display: inline;
}
span.footnote {
  float: footnote;
}
</pre>

<p>Here is one possible presentation of inline footnotes:

<pre>
&#xB9; The first footnote. &#xBA; The second footnote.
</pre>
</div>

</div>
-->
<!--
<p class=issue>Another way to achieve this would be to introduce different keywords for inline and block footnotes (e.g., float: footnote-inline, float: footnote-block).
-->

<p>For each new footnote element, the ''footnote'' counter is automatically
incremented.


<h3>The footnote area</h3>

<p>All elements with ''float: footnote'' are moved to the <em>footnote
area</em>. The footnote area is described by an @footnote-rule inside
the @page-rule. By default, the footnote area appears at the bottom of
the page, but it can be positioned in other places.

<div class="example">

<p>These rules place the footnote area at the bottom of the page,
spanning all columns of the outermost multicol element:

<pre>
@page {
  @footnote {
    float: bottom;
    float-reference: page;
  }
}
</pre>

<p>The code above is part of the default style sheet.
</div>


<div class="example">
<p>These rules place the footnote area at the bottom of the first column:

<pre>
@page {
  @footnote {
    float: bottom;
    float-reference: column;
  }
}
</pre>
</div>

<div class="example">
<p>These rules place the footnote area at the bottom of the page. Also, the footnote area is split into three columns which the footnotes are flowed into:

<pre>
@page {
  @footnote {
    float: bottom;
    float-reference: page;
    columns: 3;
  }
}
</pre>
</div>

<div class="example">
<p>This code places the footnote area at the bottom of the last column of the outermost multicol element:

<pre>
@page {
  @footnote {
    float: bottom;
    float-defer-column: last;
  }
}
</pre>

</div>


<p>The content of the footnote area is considered to come before other
content which may compete for the same space on the same page.

<div class="example">
<pre>
@page { @footnote { float: bottom; float-reference: page; }}
figure { float: bottom; column-span: all }
</pre>

<p>If figures and footnotes are on the same page, the footnotes will appear below the figures as they are floated to the bottom before the figures.
</div>

<p>Potentially, every page has a footnote area. If there
are no footnotes on the page, the footnote area will not take up any
space. If there are footnotes on a page, the layout of the footnote
area will be determined by the properties/values set on it, and by the
footnote elements inside it.

<p>These properties apply to the footnote area: 'float', 'float-reference', 'content', 'border',
'padding', 'margin', 'height', 'width', 'max-height', 'max-width',
'min-height', 'min-width', and the background properties.

<!--
<p class="note">In published books, it is customary for the footnote
area to be limited to less than half the height of the page area. Long
footnotes may need more space, and the customary solution is for
footnotes to span several pages. To achieve this, the 'max-height'
property should be used. However, footnotes spanning several pages is
an advanced feature which is not a conformance requirement for this
specification.
-->


<div class="example">
<p>This example uses some of the applicable properties on @footnote:

<pre>
@footnote {
  margin-top: 0.5em;
  border-top: thin solid black;
  border-clip: 4em;
  padding-top: 0.5em;
}
</pre>

<p>The result of this code is a footnote area separated from other content above it by margin, border and padding. Only 4em of the border is visible due to the 'border-clip' property, which is defined in <a href="http://dev.w3.org/csswg/css4-background/">CSS Backgrounds and Borders Module Level 4</a>.   <!--[[!CSS4BACKGROUND]]-->

</div>

<!--
<p class="issue">Footnotes in tables and floats may be problematic. In
some cases, the author may want the footnote to go at the end of the
table or float instead of the bottom of the page.
-->

<h3>Footnote calls</h3>

<p>When an element is moved to the footnote area,
a <em>footnote-call</em> is left behind. By default, User Agents must
behave as if this code is part of the default style sheet:

<pre>
::footnote-call {
  content: counter(footnote, super-decimal);
}
</pre>

<p>The resulting note call is a super-script decimal number.


<h3>Footnote markers</h3>

<p>A ::footnote-marker pseudo-element is added to each footnote
element, before <!--in the same place, and replacing, --> the ::before
pseudo-element (if any), and replacing the ::marker pseudo-element (if any). User agents must, by default, show the "footnote"
counter in the footnote-marker.

<div class="example">
<p>User Agents may display footnote-calls and footnote-markers this way by default:

<pre>
::footnote-call {
  content: counter(footnote, super-decimal);
}
::footnote-marker {
  content: counter(footnote, super-decimal);
}
</pre>
</div>

<!--
@counter-style super-decimal {
	type: numeric;
	glyphs: '\2070' '\B9' '\B2' '\B3' '\2074' '\2075' '\2076' '\2077' '\2078' '\2079';
	/* '⁰' '¹' '²' '³' '⁴' '⁵' '⁶' '⁷' '⁸' '⁹' */
}
-->

<p>Marker elements are discussed in more detail in the CSS Lists
module [CSSLIST]. One suggested change to that module is to honor
the value of 'list-style-position' on the ::footnote-marker
pseudo-element itself rather than the corresponding list-item element.
Further, one clarification to the horizontal placement of the marker
is suggested: the <em>margin</em> box of the marker box is
horizontally aligned with the start of the line box.


<h3>Counting footnotes</h3>

<p>The "footnote" counter is automatically incremented each time a
footnote is generated. That is, the "footnote" counter is incremented
by one each time an element with ''float: footnote'' appears.

<div class="example">
<p>This code adds square brackets around footnote calls and

<pre>
::footnote-call {
  content: " [" counter(footnote) "]";
}
</pre>
</div>


<p>The footnote counter can be reset with the 'counter-reset' property.

<div class="example">
<p>This code resets the "footnote" counter on a per-page page basis:
<pre>
@page { counter-reset: footnote }
</pre>
</div>


<!--
<p>The 'counter-increment' property can be set in the @footnote rule.
Each time an element with 'float: footnote' is found, the corresponding
counter is incremented.

<div class="example">
<p>This rule is part of the default style sheet:

<pre>
@page {
  @footnote {
    counter-increment: footnote;
  }
}
</pre>

As a result, the "footnote" counter is incremented each time a footnote is generated.
</div>
-->

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/e-footnotes-leaders-line-numbers.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-footnotes-leaders-line-numbers-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-footnotes-leaders-line-numbers-pr.pdf">Prince</a>
</div>

<div class=example>

<p>Footnotes can also be combined with other counters. In this example, a poem is shown with line numbers on the side. The "line" counter is also used in the footnoter marker.

<pre>
@page { counter-reset: line }
div.line { counter-increment: line }
div.line:nth-of-type(2n+1)::after { content: leader(space) counter(line) }
.footnote { float: footnote }
.footnote::footnote-call { content: "" }
.footnote::footnote-marker { content: counter(line) }
</pre>

<p>The formatted result could be:

<pre>
Come, blue-eyed maid of heaven! - but thou, alas,       1
Didst never yet one mortal song inspire -
Goddess of Wisdom! here thy temple was,                 3
And is, despite of war and wasting fire,

1 From "Childe Harold's Pilgrimage" by Lord Byron
3 The use of uppercase "W" indicates great wisdom
</pre>

</div>


<h3>Laying out footnotes</h3>

<p>Footnotes must appear as early as possible under the following constraints:

<ol>

<li>A footnote marker may not appear on an earlier page than the
    footnote call.

<li>Footnotes may not appear out of document order.

<!--<span class="issue">(What order is that: the document order or the visual order?
    Probably the document order, the same order as the footnote counter
    values, although the visual order of the footnote calls may be
    different, due to their occurrence in positioned and floating
    elements.)</span>-->

<li>The footnote area is limited in size by 'max-height', unless the
    page contains only footnotes. (E.g., if at the end of the document
    there are still footnotes unprinted, the User Agent can use the whole page to
    display footnotes.)

<li>If there is a footnote call on a page, the footnote area may not
    be empty, unless its 'max-height' is too small.

</ol>

<!--
<h2>Sidenotes</h2>

<p>Sidenotes are supported the same way as footnotes; only the name
and the settings in the default style sheet differentiates the two.

<div class="example">
<p>This example moves images to the outside margin of pages:

<pre>
@page :left {
  margin-left: 10em;
  @sidenote { position: absolute; left: -8em; top: 0; width: 6em; height: auto }
}
@page :right {
  margin-right: 10em;
  @sidenote { position: absolute; right: -8em; top: 0; width: 6em; height: auto }
}
.sidenote { float: sidenote }
</pre>

<p>It is important to note that it is the sidenote area that is descibed by @sidenote, and not the elements that are floated into the sidenote area.
</div>

-->

<h2>Named Areas</h2>
<!--
<p class=issue>add example with aside
<p class=issue>describe content model, how to empty/reset named areas
<p class=issue>what role should fixed areas have
-->

<p>The page area and footnote area are predefined areas in CSS; all content is shown in the page area by default, and footnotes can be floated to the page area. This section describes a generic mechanism to create <dfn>named areas</dfn>, how to posistion named areas, and how to flow content into named areas.

<h3>Creating names areas: <code>@area</code></h3>

<p>Named areas can be generated by the style sheet to provide space for sidenotes, figures and other content which is presented apart from the main flow. The <code>@area</code> construct is used to create named areas, into which content can be flowed into with the 'flow' property.

<p>Named areas are can be absolutely positioned, or positiond with the 'float' property. When absolutely positioned, measurements are relative to the page box.

<div class=example>
<p>In this example, a named area called <em>sidenote</em> is created.

<pre>
@page {
  margin-left: 10em;
  @area sidenote { position: absolute; left: -8em; top: 0; width: 6em; height: auto }
}
</pre>

<p>The left edge of the named area is 8em to the left of the left edge of the page box.

</div>

<p>Areas with the same name are connected and content can flow from such area to the next, when necessary.

<div class="example">
<p>In this example, both left and right pages have a sidenote area:

<pre>
@page :left {
  margin-left: 10em;
  @area sidenote { position: absolute; left: -8em; top: 0; width: 6em; height: auto }
}
@page :right {
  margin-right: 10em;
  @area sidenote { position: absolute; right: -8em; top: 0; width: 6em; height: auto }
}
</pre>

<p>The baseline of the sidenotes are aligned with the baseline of their reference point.

</div>

<p>To support having several identically named areas on the same page,
a second level of @area blocks are used. Only two levels of @area are
allowed. The outer @area must always have a name, and the inner @area
must never have a name. The named areas are painted as if they
appeared in the source file after the footnote area, and before any
content.

<div class=example>
<pre>
@page {
  margin-left: 1cm 5cm;  /* wide side margins */
  @area sidenote {
    @area { position: absolute; left: -4cm; top: 0; bottom: 0; width: 3.5cm; } /* left */
    @area { position: absolute; right: -4cm; top: 0; bottom: 0; width: 3.5cm; } /* right */
  }
}
</pre>
</div>


<h3>Flowing content to a named area: 'flow'</h3>

<p>The 'flow' property is introduced to flow content into a named area. A functional notation indicates a named area, alignment within the named area, and placement policy.

<pre>
   area(&lt;ident> [, &lt;alignment> [, &lt;placement-policy> ]]);
</pre>

<p>Aligmment is one of:

<dl>

<dt>baseline
<dd>element requests that its first baseline is aligned with the baseline of its reference point in the closest matching named area. This is the default value.

<dt>same-page

<dd>element requests to be filled into the first available space in the first matching named area on the same page

<dt>same-spread

<dd>element requests to be filled into the first available space in the first matching named area on the same spread

<dt>fill
<dd>element requests to be filled into the first available space in the first matching named area on any page

<dt>top-edge
<dd>element requests that its top border edge is aligned with the top border edge of the BFC of the reference point in the closest matching named area

<dt>bottom-edge
<dd>element requests that it bottom border edge is aligned with the bottom border edge of the BFC of the reference point in the closest matching named area

</dl>

<p>An optional exclamation mark ('!') can be added to the above keywords to express that aligment is essential: if it cannot be honored, the ele,ment will not be shown.


<div class=example>
<p>This code moves &lt;aside> elements to the named area called "sidenote" on the same page as the reference point:

<pre>
aside { flow: area(sidenote, same-page); }
</pre>
</div>


<div class=example>
<p>In this example, images are flowed to right pages, where the "photos" area take up all available space:
<pre>
@page :right {
  @area photos {
    float: top;
    float-reference: bleed-box;
    width: 1vw;
    height: 1vh;
  }
}
img { flow: area(photos) }
</pre>

<p>The result is a document where content in the normal flow is shown on left pages, and right pages hold images. The images are filled into the named area in sequential order.

</div>



<div class=example>
<pre>
@page {
  margin-left: 1cm 5cm;  /* wide side margins */
  @area sidenote {
    @area { position: absolute; left: -4cm; top: 0; bottom: 0; width: 3.5cm; } /* left */
    @area { position: absolute; right: -4cm; top: 0; bottom: 0; width: 3.5cm; } /* right */
  }
}
.sidenote { flow: area(sidenote, baseline) }
</pre>

<p>One possible rendering is:
<pre>
            ........ .........
            ........ .........
            ........ ...2..... second
            ........ ......... sidenote
            ........ .........
      first ....1... .........
   sidenote ........ .........
            ........ ....3.... third
            ........ ......... sidenote
            ........ .........
</pre>
<p>The digits mark the call points.
</div>

<!--
<pre>
  area( <a href="http://www.w3.org/TR/css3-values/#custom-idents">&lt;custom-ident&gt;</a> )
</pre>
-->

<div class=example>
<p>In this example there are two streams of footnotes, both using named areas. The first stream flowed into the "fn1" area, and the second is flowed into "fn2". The first stream is referenced by numbers, and the second by lower-alpha.

<pre>
@page {
  @area fn1 { float: bottom; float-reference: page }
  @area fn2 { float: bottom; float-reference: page }
}

.fn1 { flow: area(fn1, same-page); counter-increment: fn1 }
.fn1::call { content: "[" counter(fn1) "]" }
.fn2::marker { content: "[" counter(fn1) "]" }

.fn2 { flow: area(fn2,same-page); counter-increment: fn2 }
.fn2::call { content: "[" counter(fn2, lower-alpha) "]" }
.fn2::marker { content: "[" counter(fn2, lower-alpha) "]" }
</pre>

<p>In the formatted result, the named areas appear at the bottom of the page; fn1 is floated to the bottom first and therefore appears below fn2. A possible rendering could be:

<pre>
[a] From "Childe Harold's Pilgrimage" by Lord Byron
[3] The use of uppercase "W" indicates great wisdom
</pre>

</div>

<!--
<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/e-leaders-line-numbers.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-leaders-line-numbers-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-leaders-line-numbers-pr.pdf">Prince</a>
</div>
-->

<div class=example>
<p>In this example there are two streams of footnotes. The first stream is floated to the predefined "footnote" area, and the second is flowed to a name area called "fn2". The first stream is referenced by line numbers, and the second by lower-alpha.

<pre>
@page {
  counter-reset: line
  @area fn2 {
    float: bottom;
    float-reference: page;
  }
}
div.line { counter-increment: line }
div.line:nth-of-type(2n+1)::after { content: leader(space) counter(line) }

.footnote { float: footnote }
.footnote::footnote-call { content: "[" counter(footnote, lower-alpha) "]" }
.footnote::footnote-marker { content: "[" counter(footnote, lower-alpha) "]" }

.fn2 { flow: area(fn2, same-page) }
.fn2::call { content: "" }
.fn2::marker { content: "[" counter(line) "]" }
</pre>


<p>In the formatted result, the footnote area appears below the named area.

<pre>
Come, blue-eyed maid of heaven! - but thou, alas,[a]       1
Didst never yet one mortal song inspire -
Goddess of Wisdom! here thy temple was,                    3
And is, despite of war and wasting fire,

[3] The use of uppercase "W" indicates great wisdom
[a] From "Childe Harold's Pilgrimage" by Lord Byron
</pre>

</div>




<div class=example>
<p>Consider this code:

<pre>
.s1 { flow: area(sidenote, same-page) }
.s2 { flow: area(sidenote, same-page) }
</pre>

<p>When there is one sidenote area, to the left of the first column, the rendering may look like:

<pre>
┌─────┐......1.....  ............
│ s1  │............  ............
└─────┘............  ............
┌─────┐............  ............
│ s2  │............  ............
└─────┘............  ............
       ............  ....2.......
       ............  ............
       ............  ............
</pre>
</div>

<div class=example>
<p>This example is similar to the previous example, except that there are two sidenote areas: left of the first column, and right of the second column. The sidenote elements are move to the closest sidenote area:

<pre>
.s1 { flow: area(sidenote, same-page)
.s2 { flow: area(sidenote, same-page)
</pre>

<pre>
┌─────┐......1.....  ............┌─────┐
│ s1  │............  ............│ s2  │
└─────┘............  ............└─────┘
       ............  ............
       ............  ............
       ............  ............
       ............  ....2.......
       ............  ............
       ............  ............
</pre>
</div>


<div class=example>
<p>In this example, figures appear in the main flow, while captions are flowed to the closest sidenote areas (there are two: left of the first column, and right of the second column). The captions are aligned with the top of the figure element.

<pre>
figcaption { flow: area(sidenote, top-edge) }

&lt;figure>
  &lt;figcaption>s1&lt;/figcaption>
&lt;/figure>
&lt;figure>
  &lt;figcaption>s2&lt;/figcaption>
&lt;/figure>
</pre>

<pre>
       ............  ............
       ............  ............
┌─────┐┌──────────┐  ............
│ s1  ││ fig1     │  ┌──────────┐┌─────┐
└─────┘│          │  │ fig2     ││ s2  │
       │          │  │          │└─────┘
       └──────────┘  │          │
       ............  └──────────┘
       ............  ............
       ............  ............
       ............  ............
</pre>
</div>


<div class=example>
<p>In this example, the figure has an image that spans the width of the page and bleeds to the edges. The caption follows underneath, in the sidenote area. The intended rendering is:

<pre>
 ┌──────────────────────┐
 │ image                │
 │                      │
 │                      │
 └──────────────────────┘
 ┌────────┐  ...........
 │caption │  ...........
 └────────┘  ...........
             ...........
             ...........
</pre>

<P>The style sheet define two name areas, one for the photograph and one for the sidenote. The "photo" named area is floated to the top, while the "sidenote" area is absolutely positioned. The two named areas overlap. Therefore, the order of the content is significant; the image is first flowed into the "photo" area. The position of the caption will be influcenced by the height of the image.

<pre>
@page {
  margin: 7mm 7mm 7mm 40mm;
  @area photo { float: top; float-reference: bleed-box }
  @area sidenote { position: absolute; left: -40mm; top: 0; bottom: 0; width: 35mm; }
}
figure img { flow: area(photo, same-page); clear: page }
figcaption { flow: area(sidenote, same-page) }

...

&lt;figure>
  &lt;img>
  &lt;figcaption>caption&lt;/figcaption>
&lt;/figure>
</pre>

</div>

<!--
<p>If the requested placement can be achieved in two or more named areas, the closest named area is chosen. If the requested alignment is not possible in any named area, the closest named area is chosen and the element is



<div class=example>

<pre>
img { flow: area(sidenote) }                      /* this is the default */
img { flow: area(sidenote, baseline same-page) }  /* this is also default */

img { flow: area(sidenote, fill) }             /* show float in the order they appear */
img { flow: area(sidenote, fill same-spread) } /* show float in the order they appear, use any matching named flow on the spread of the reference point */
</pre>

</div>
-->

<div class=example>
<p>In this example, photographs are shown on right pages while the corresponding captions are flowed to a sidenote area on left pages.

<pre>
@page :right {
  margin-right: 10em;
  @area photos {
    position: absolute;
    top: 0; right: -10em; bottom: 0; left: 0;
  }
}
@page :left {
  margin-left: 10em;
  @area sidenote { position: absolute; right: -8em; top: 0; width: 6em; height: auto }
}
img { flow: area(photos) }
caption { flow: area(sidenote) }
</pre>

<p>When there is one sidenote area, to the left of the first column, the rendering may look like:

<pre>
┌─────┐ ......1..... ┌─────────────┐
│ s1  │ ............ │photo 1      │
└─────┘ ............ │             │
┌─────┐ ............ └─────────────┘
│ s2  │ ............ ┌──────────┐
└─────┘ ............ │photo 2   │
        .........2.. │          │
        ............ └──────────┘
        ............
</pre>
</div>



<h3>Placement policy</h3>

<p class=note>This is fairly sketchy</p>

<p>An optional argument indicates a placement policy:

<dl>
<dt>erase
<dd>element erases any other content which may have been flowed to the named area

<dt>stick
<dd>Element sticks to the named area and is repeated on any subsequent pages which has the same named ares. Also, element erases any other content which may have been flowed to the named area.

<dt>copy
<dd>rather than being moved, the element is copied to the named area.

</dl>


<div class=example>

<p>In this example, there are two named areas called "sidenote", one
on the left side of the first column, and the other on the right side
of the second column. Three reference points are marked with 1,
2, and 3. Exact alignment along the baseline is possible for all three notes.

<pre>
            ........ .........
            ........ .........
            ........ ...2..... second
            ........ ......... sidenote
            ........ .........
      first ....1... .........
   sidenote ........ .........
            ........ ....3.... third
            ........ ......... sidenote
            ........ .........
</pre>

<p>The code used to achieve this is:

<pre>
.sidenote { flow: area(sidenote, baseline) }
</pre>

</div>

<div class=example>

<p>This example is similar to the previous one, except for the placement of the third reference point: it appears much closer to the second reference point. As a result, the second sidenote pushes down the third sidenote, which is no longer exactly aligned along the baseline.

<pre>
            ........ .........
            ........ .........
            ........ ...2..... second
            ........ .....3... sidenote
            ........ ......... third
      first ....1... ......... sidenote
   sidenote ........ .........
            ........ .........
            ........ .........
            ........ .........
</pre>
</div>


<div class=example>

<p>This example is similar to the previous one, except that 'baseline!' is used:

<pre>
.sidenote { flow: area(sidenote, baseline!) }
</pre>

<p>As a result, the third sidnote (which cannot be granted its requested placement) is not shown:

<pre>
            ........ .........
            ........ .........
            ........ ...2..... second
            ........ .....3... sidenote
            ........ .........
      first ....1... .........
   sidenote ........ .........
            ........ .........
            ........ .........
            ........ .........
</pre>
</div>




<div class=example>
<p>First, move an element to a named area:

<pre>
aside { flow: area(sidenote, same-page) }
</pre>

<p>Then, make the element stick so that it is shown on succeeding pages:

<pre>
h1.copy { flow: area(sidenote, same-page, stick) }
</pre>
</div>


<div class=example>
<pre>
aside { flow: area(sidenote, same-page, erase) }
</pre>
</div>


<div class=example>
<p>In this example, the h1 element is copied into a running header which is defined with @area. The copied element is restyled. It erases the running header when it enters, and is set to stick (until eased by another element):

<pre>
@page :left {
  @area running-header {
    position: absolute; top: -2cm; left: 0; width: 3.5cm; height: 1cm
    @inside h1 {
      font: 12pt sans-serif;
      text-align: right;
    }
  }
}
@page :right {
  @area running-header {
    position: absolute; top: -2cm; right: 0; width: 3.5cm; height: 1cm
    @inside h1 {
      font: 12pt sans-serif;
      text-align: right;
    }
  }
}

h1 { flow: area(running-header, same-page, stick) }
</pre>
</div>


<div class=example>
<p>In this example, the named area called "running header" is placed in the center top of the page. It is filled with three elements, one being the copy

<pre>
@page {
  @area running-header {
    position: absolute; top: -2cm; left: 0; right: 0; height: 1cm;
    text-align: center;
    @inside h1 {
      font: 12pt sans-serif;
      display: inline;
    }}}

#pagecounter {
  flow: area(running-header, fill, stick); content: counter(page);  }
#ornament {
  flow: area(running-header, fill, stick); color: red; content: "\2747" /* snow crystal */}
h1 {
  flow: area(running-header, fill, copy stick); font: 12pt serif }

&lt;span id=pagecounter>&lt;/span>
&lt;span id=ornament>&lt;/span>
&lt;h1>Erin Hildebrand&lt;/h1>
</pre>

</div>


<h3>Note calls: <code>::call</code></h3>

<p>Elements that are floated to named areas can add a "call", similar to a footnote-call, at the place where they were floated from.

<div class=example>
<pre>
.sidenote {
  flow: area(sidenote, same-page);
  counter-increment: sn;
}
.sidenote::call {
  content: counter(sn, lower-alpha); font-size: 0.6em; vertical-align: top;
}
</pre>
</div>

<h3>Floating elements to margin boxes</h3>

<p>Margin boxes can be considered a special type of named areas. Unlike names areas, margin boxes:

<ul>
<li>are predefined (there are 16 of them)
<li>come with default settings on 'text-align' and 'vertical-align'
</ul>

<p>The 'margin()' function moves elements to margin areas:

<div class=example>
div.running-header { flow: margin(top-left) }      /* move to top-left margin area */
h1 { flow: margin(top-right, copy) }               /* copy to margin area */
</div>



<h3>Pulling content: <code>target-pull()</code></h3>

<div class=example>

<p>To support legacy browsers, it is often better to make a link to
the note rather than including the text inline. This example shows how
to fetch the content of a note and place it in a footnote.

<pre>
&lt;style>
@media print {
  .footnote {
    float: footnote;
    content: target-pull(attr(href url)) }
  .call { display: none }
}
&lt;/style>
...
&lt;p>A sentence consists of words&lt;a class="footnote" href="#words"> [3]&lt;/a>.
...
&lt;p id=words>&lt;span class="call">[3]&lt;/span> Most often.
</pre>

<p>When shown in a legacy browser, the content of the element will be
shown as a clickable link to an endnote. When printed according to
this specification, there will be a footnote:

<pre>
A sentence consists of words&#xB9;.

&#xB9; Most often.
</pre>
</div>

<div class=example>
<p>When footnotes are long or complex, it may be impractical to keep their content at the point of reference. Instead, the content of the footnote may be stored at some other point in the source file.  This example shows how to fetch the content of a note and place it in a footnote.

<pre>
&lt;style>
@media print {
  .footnote {
    float: footnote;
    content: target-pull(attr(href url)) }
}
&lt;/style>
...
&lt;p>A sentence consists of words&lt;a class="footnote" href="#words">&lt;/a>.
...
&lt;div id=words>Most often, a sentence consists of words. However, some sentences also
  have &lt;em>numbers&lt;/em>. And punctuation, don't forget punctuation.&lt;/div>
</pre>
</div>


<!--
<h2>Inside/outside properties</h2>

<p>Named areas, as defined above, is a powerful mechanism which can render many types of sidenotes. However, the implementation cost is significant.
-->

<h2>Bookmarks</h2>

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/bookmarks.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/bookmarks-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/bookmarks-pr.pdf">Prince</a>
</div>

<p>Some document formats have the capability to represent bookmarks
into the document. These bookmarks can e.g. be used to show an outline
or an index of the document. Bookmarks are typically shown outside the
document itself, often in a tree-structured and clickable table of
contents. To generate bookmarks, these properties are defined:
'bookmark-level', 'bookmark-label', and 'bookmark-state'.

<h3>'bookmark-level'</h3>

<table class=propdef>
    <tr>
      <td><em>Name:</em>
      <td><dfn>bookmark-level</dfn>
    <tr>
      <td><em>Value:</em>
      <td>none | &lt;integer>
    <tr>
      <td><em>Initial:</em>
      <td>none
    <tr>
      <td><em>Applies to:</em>
      <td>all elements
    <tr>
      <td><em>Inherited:</em>
      <td>no
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Media:</em>
      <td>all
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>specified value
</table>

<p>This property describes what level a certain bookmark has in a
hierarchical bookmark structure. The values are:

<dl>

<dt>none

<dd>no bookmark is generated

<dt>&lt;integer>

<dd>Indicates the level of the bookmark; the highest level is ''1'', then ''2'', ''3'' etc. Zero and negative values are not allowed.

</dl>


<h3>'bookmark-label'</h3>

<table class=propdef>
    <tr>
      <td><em>Name:</em>
      <td><dfn>bookmark-label</dfn>
    <tr>
      <td><em>Value:</em>
      <td><a href="#content-list">&lt;content-list></a> | none
    <tr>
      <td><em>Initial:</em>
      <td>none
    <tr>
      <td><em>Applies to:</em>
      <td>all elements
    <tr>
      <td><em>Inherited:</em>
      <td>no
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Media:</em>
      <td>all
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>specified value
</table>

<p>This property specifies the label of the bookmark, i.e., the text that will represent the bookmark in the bookmark structure. This properly will only be consulted if 'bookmark-level' is different from 'none'. The values are:

<dl>

<dt><a href="#content-list">&lt;content-list></a>

<dd>as defined on the 'string-set' property

<dt>none

<dd>no bookmark is generated

</dl>


<div class="example">
<p>This code would generate a simple hierachical outline of a document that uses three heading levels:

<pre>
h1 { bookmark-level: 1 }
h2 { bookmark-level: 2 }
h3 { bookmark-level: 3 }
h1, h2, h3 { bookmark-label: content() }
</pre>
</div>

<div class="example">
<p>This code will make bookmarks from links.
<pre>
a[href] { bookmark-label: attr(href); bookmark-level: 1 }
a[title] { bookmark-label: attr(title); bookmark-level: 1 }
</pre>
<p>If a <code>title</code> attribute exisits, its value will be used as the bookmark label. Otherwisee, the URL is used.
</div>

<div class="example">
<p>This code specififies a string to be used as the bookmark label:
<pre>
#frog { bookmark-label: "The green frog"; bookmark-level: 1 }
</pre>
</div>

<div class="example">
<p>Consider this code:
<pre>
h1 { bookmark-label: content(before) ": " content(); bookmark-level: 1 }
h1:before { content: "Chapter" }

&lt;h1>Africa&lt;/h1>
</pre>

<p>The resulting bookmark would be: "Chapter: Africa".
</div>


<h3>'bookmark-state'</h3>


<table class=propdef>
    <tr>
      <td><em>Name:</em>
      <td><dfn>bookmark-state</dfn>
    <tr>
      <td><em>Value:</em>
      <td>open | closed
    <tr>
      <td><em>Initial:</em>
      <td>open
    <tr>
      <td><em>Applies to:</em>
      <td>block-level elements
    <tr>
      <td><em>Inherited:</em>
      <td>no
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Media:</em>
      <td>all
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>specified value
</table>

<p>A hierarchy of bookmarks may be shown in an open or closed state.
The user will typically be able to toggle the state to navigate in the
bookmarks. This property describes the initial state of a bookmark.

<div class=example>
<p>In this example, <code>h1</code> and <code>h2</code> elements are set to have an open initial bookmark stat, all other elements will be closed initially:

<pre>
* { bookmark-state: closed }
h1, h2 { bookmark-state: open }
</pre>
</div>


<h2>Page selectors</h2>

<p>A document consists of a linear sequence of pages. In simple documents, all pages have the same page area and marginalia. In more complex documents, pages may have different sizes, marginalia and orientation. Being able to style pages differently is therefore important.

<p>In CSS2, <a href="http://www.w3.org/TR/CSS2/page.html#page-selectors">first, left and right pages</a>, as well as named pages, can be selected. This specification adds more advanced page selectors. Page selectors are similar to normal selectors in the sense that they query a data set and select parts of it. However, page selectors and normal selector are different in what they query (normal selectors query a document tree; page selectors query a sequence of pages) and what they select (normal selectors find structured elements, page selectors find formatted pages).

<h3>The <code>nth()</code> page pseudo-class</h3>

<p>The <code>nth()</code> construct is added to select a numbered page.

<div class=example>
<p>These are equivalent, they both select the first page of a document:
<pre>
@page :first { background: lime }
@page :nth(1) { background: lime }
</pre>
</div>

<p>The grammar of <a href="http://www.w3.org/TR/css3-selectors/#nth-child-pseudo">nth-child() pseudo-class</a> can be used with <code>nth()</code>:

<div class=example>
<p>In this example, pages in a document will cycle through pink, lime and white backgrounds:
<pre>
@page :nth(3n) { background: pink }
@page :nth(3n+1) { background: lime }
@page :nth(3n+2) { background: white }
</pre>
</div>


<!--
<h3>The <code>range()</code> page pseudo-class</h3>

<p class=issue>This may be more important when printing a document, than when styling a document.

<p>The :range() page pseudo-class is added to select a range of pages. The syntax is:

<pre>
  :range( S* [ [0-9]+ S* - S* [0-9] ] | [0-9]+\+ | [0-9]+ ] S* )
</pre>

<div class=example>
<p>In this example, page 3, 4, and 5 of the document will have a pink background.
<pre>
@page :range(3-5) { background: pink }
</pre>
</div>

<div class=example>
<p>In this example, all but page 1 and 2 will have a pink background.
<pre>
@page :range(3+) { background: pink }
</pre>
</div>

<div class=example>
<p>In this example, the second page of all chapter page groups will have a pink background.
<pre>
@page chapter:range(2) { background: pink }
</pre>
</div>
-->

<h3>Page groups</h2>

<p>A <dfn>page group</dfn> is a sequence of pages with the same name. Being able to style the first page of page group different from the other pages in the page group is important. To support this, the named page and the <code>:first</code> and <code>:nth()</code> selector can be combined with the page name in page selectors:

<div class=example>
<p>In this example, various background colors will be set on different pages in the "chapter" page group:
<pre>
@page chapter:first { background: pink }  /* the first page */
@page chapter:nth(1) { background: pink }  /* the first page */
@page chapter:nth(2) { background: lime }  /* the second page */
@page chapter:nth(3n+2) { background: white }  /* every third page */
</pre>
</div>

<p>A new page group is started when an element is set to a named page which is different from the preceding element, or different from the ancestor element.

<div class=example>
<p>In this example, the first article starts a new page group due to having a different named page than its ancestor. However, the second article continues in the same page group as the first, due to having the same named page. As a result, there will only be one page with a green background.

<pre>
@page chapter:first { background: green }
body { page: upright }
article { page: chapter }

&lt;body>
  &lt;article>...&lt;/article>
  &lt;article>...&lt;/article>
&lt;/body>
</pre>
</div>

<p>To enable page groups to be created when sibling elements use the same named page, the 'break-before' and 'break-after' properties are consulted. When a forced page break has been set between the two elements (either 'break-after: page' on the first element, or 'break-before: page' on the second element), the second element will create a new page group.

<div class=example>
<p>In this example, both articles start new page groups due to there being an explicit page break between them.

<pre>
@page chapter:first { background: lime }
body { page: upright }
article { page: chapter; break-before: page }

&lt;body>
  &lt;article>...&lt;/article>
  &lt;article>...&lt;/article>
&lt;/body>
</pre>
</div>

<!--
 are named with the 'page' property, and
selected with a <a href="http://www.w3.org/TR/css3-page/#page-type-selector">page
type selector</a>.
-->

<!--
<p>A document consists of a linear sequence of pages. In simple
documents, all pages have the same page area and marginalia. In more
complex documents, pages may have different sizes, marginalia and
orientation. Being able to style pages differently is therefore
important. Styling can be based on automatic classification (like the
pseudo-classes described in the previous section), or explicitly named
page groups. Page groups are named with the 'page' property, and
selected with a <a href="http://www.w3.org/TR/css3-page/#page-type-selector">page
type selector</a>.

<p>The syntax of page selectors are:

<pre>
@page [ \S+ &lt;page-group>? [ : page-pseudo-class ]* ] | [ \S* [ : *page-pseudo-class ]+
</pre>

<div class=example>
<pre>
@page chapter { @bottom-center { content: counter(page) }
div.introduction { page: chapter }
</pre>
</div>

<p>A sequence of pages with the same name is automatically combined
into a page group. It is sometimes necessary to split one page group
into several page groups in order to, e.g., address the first page in
the group. The 'page-group' property expresses whether an element
starts a new page group or not.

<table class=propdef>
    <tr>
      <td><em>Name:</em>
      <td><dfn>page-group</dfn>
    <tr>
      <td><em>Value:</em>
    <td>auto | start
    <tr>
      <td><em>Initial:</em>
      <td>auto
    <tr>
      <td><em>Applies to:</em>
      <td>elements with 'page' value other than auto
    <tr>
      <td><em>Inherited:</em>
      <td>no
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Media:</em>
      <td>paged
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>as specified
</table>

<p>This property determines whether the element starts a new page group or not.

<dl>
<dt>auto
<dd>The element only starts a new page group if 'page' has a named page different from the the previous element.

<dt>start
<dd>The element always starts a new page group.

</dl>


<div class=example>

<p>In this example, each article starts a new page group so that the first page of each article has a pink background.

<pre>
@page funky:first {
  background: pink;
}
article {
  page: funky;
  page-group: start;
}
</pre>

<p>Without the 'page-group: start' declaration, only the first page of the first article would be pink.

</div>

<p>When a <a href="http://www.w3.org/TR/css3-page/#page-pseudo-class">page pseudo-class</a> is combined with a <a href="http://www.w3.org/TR/css3-page/#page-type-selector">page type selector</a> (also called a "page group selector"), the page pseudo-classes query pages within that page group.

<div class=example>
<p>When used alone, ":first" selects the first page of the document. When combined with a page group selector, ":first" selects the first page in a page group

<pre>
@page :first { ...  }         /* selects the first page of the document */
@page chapter:first { ... }   /* selects the first page of every "chapter" page group */
</pre>

<p>This is similar to how the <code>:nth-of-type()</code> selector works.


</div>

<h3>Automatic page groups</h3>

<p>An alternative to setting page groups explicitly is to assume
that elements with 'break-before: page' starts a new page group:

<pre>
@page chapter:first { background: yellow }

.chapter {
   page: chapter;
   break-before: page;
}
</pre>


<!--<p>Another way to think of it is that a page selector without any explicit page group has a default, invisible page group. If it had been named "document", the selector for the first page in the document would have been "document:first".-->

<!--
<p class=note>Another wayComplex page selectors
this is like
 :nth-of-type()
or like pseudo-elements
</p>
-->

<!--
<h3>Complex page selectors</h3>

<p>Complex page selectors are formed by combining several <a href="http://www.w3.org/TR/css3-page/#page-pseudo-class">page pseudo-classes</a>, or by combining one <a href="http://www.w3.org/TR/css3-page/#page-type-selector">page type selector</a>, called "page group selector" in this document, with one or more page pseudo-classes.

<p>When two or more page pseudo-classes are combined into a complex page selector, it selects all pages that match all pseudo-classes.

<div class=example>
<pre>
@page :first:nth(2) { background: lime } /* select pages that are both first and second. I.e. none */
@page :right:nth(3n) { background: lime } /* selects every third page, but only those on the right */
@page :nth(20-40):odd { ... } /* all odd pages between 20 and 40 (inclusive) */
</pre>
</div>
-->

<h2>Conditional content</h2>

<p>Content is sometimes displayed or hidden based on their placement
after formatting. This specification proposes the 'condition' property
to express conditions that must be met in order for the element to be
displayed; if the condition is not met, the effect will be as if
'display: none' had been set.

<div class=example>
<p>In this example, thematic breaks within the prose is normally indicated by a few blank lines. However, if the thematic break appears at a page break, it will be indicated by three asterisks.

<pre>
  .tb:before { content: "***"; condition: at-page-break; margin: 1em 0; text-align: center;  }
  .tb:after  { content: "\a\a\a"; condition: not-at-page-break }

  &lt;div class=tb>&lt;/div>
</pre>

</div>


<h2>Clipping column rules</h2>


<h3>column-rule-clip</h3>

<table class=propdef>
    <tr>
      <td><em>Name:</em>
      <td><dfn>column-rule-clip</dfn>
    <tr>
      <td><em>Value:</em>
    <td>none | auto | [ &lt;length> &lt;length>? ]
    <tr>
      <td><em>Initial:</em>
      <td>none
    <tr>
      <td><em>Applies to:</em>
      <td>multicol elements
    <tr>
      <td><em>Inherited:</em>
      <td>no
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Media:</em>
      <td>visual
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>as specified
</table>

<p>Values are:

<dl>
<dt>none
<dd>no clipping is performed

<dt>auto
<dd>column rules are clipped so that they align with prominent font features; for latin scripts this means that the top end of the column rule aligns with the ex-height of the dominant font, while the bottom end of the rule aligns with the baseline of the dominiant font.

<dt>length
<dd>If one value is specified, the top and bottom of all column rules are clipped by specified length. If two values are specified, the first value applies to the top column rules and the second value applies to the bottom column rules.
</dl>

<p>Spanners split column rules, and each fragment is possibly clipped by this property.

<h2>Selecting elements within pages</h2>

<p class="note">This section sketches several possible solutions.


<div class=example>

<p>To select elements depending on which page they start on, these pseudo-classes can be used:

<pre>
aside:left { background: red }
aside:right { background: green }
aside:first { background: blue }
aside:nth(4n+1) { background: pink }
</pre>
</div>


<p>To select elements within a page, normal selectors can be combined with a page selector.

<div class=example>
<pre>
@page :first p { background: lime }
@page :nth(1) .sidenote { background: lime }
@page :nth(3n+1) p:first-line { background: lime }
@page funky:nth(1) p { background: pink }
</pre>
</div>

<p>The syntax is:

<pre>
  @page \S+ &lt;page-selector> \S+ &lt;selector>
</pre>


<p>In an alternative longhand syntax, selectors are placed inside an @inside-block:

<div class=example>
<p>These are identical:

<pre>
@page :left {
  @inside {
    p { text-align: left }
  }
}

@page :left p { text-align: left }
</pre>
</div>

<p>The longhand syntax also allows the styling of elements that appear inside page areas and margin boxes.

<div class=example>
<p>In this example, two sidenote areas are declared. Paragraphs inside those areas are given a differnet styling based on which side they are in.
<pre>
@page {
  margin-left: 1cm 5cm;  /* wide side margins */
  @area sidenote {
    @area {
      position: absolute; left: -4cm; top: 0; bottom: 0; width: 3.5cm; /* left sidenote */
      @inside p {
        text-align: right;   /* paragraphs in left sidenotes are aligned right */
      }
    }
    @area {
      position: absolute; right: -4cm; top: 0; bottom: 0; width: 3.5cm; /* right sidenote */
      @inside p {
        text-align: left;   /* paragraphs in right sidenotes are aligned left */
      }
    }
  }
}
</pre>
</div>

<div class=example>
<pre>
@page :left {
  background: pink;            /* declaration applies to pages */
  @inside {
    p { text-align: left }     /* declaration applies to elements on page */
  }
  @top-center {
    background: orange;        /* declaration applies to margin box */
    @inside {
      p { text-align: left }   /* declaration applies to elements in top-center margin boxes */
    }
  }
}
</pre>
</div>


<h2>Selecting columns</h2>

<p class="issue">This section is not fully developed.

<div class=example>
<pre>
div.chapter:column(3)       /* the 3rd column of the element */
div.chapter:column(2n)      /* all even columns of the element */
div.chapter:column(3+)      /* all columns but the 1st and 2nd */
div.chapter:column(2,2)     /* second column on second page */
div.chapter:column(*,2)     /* all columns on the second page */
div.chapter:column(1,*)     /* the first column on all pages */
</pre>
</div>



<h2>Baseline grids</h2>

<!-- http://antennahouse.com/xslfo/extension.htm#axf.baseline-grid -->

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/baseline-grid.html">html</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/baseline-grid-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/baseline-grid-pr.pdf">Prince</a>
</div>


<p>Text in adjacent columns often use the same baselines. This appears more pleasant to typographers, and reduces <em>show-through</em>, where a printed line shows through to the other side of the sheet. By aligning text to a grid of baselines, a <em>baseline rhythm</em> is established. Subheadings and figures may disturb the baseline rhythm, but subsequent text should find it again. The 'baseline-grid' property is introduced to define, engage and clear baseline grids, while the 'baseline-block-snap' property indicates how to align elements that do not align themselves with a baseline grid.

<h3>'baseline-grid'</h3>

<table class=propdef>
    <tr>
      <td><em>Name:</em>
      <td><dfn>baseline-grid</dfn>
    <tr>
      <td><em>Value:</em>
    <td>normal | none | new | root | page
    <tr>
      <td><em>Initial:</em>
      <td>normal
    <tr>
      <td><em>Applies to:</em>
      <td>block containers
    <tr>
      <td><em>Inherited:</em>
      <td>no
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Media:</em>
      <td>visual
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>as specified
</table>

<p>This property is used to <em>define</em>, <em>engage</em>, and <em>clear</em> baseline grids. When a baseline grid is enganged, it will be <em>in effect</em> on content inside the block container (including child elements) until another baseline grid is engaged, or the baseline grid is cleared. When a baseline grid is in effect, content will be aligned with the baseline grid.

<dl>

<dt>normal

<dd>The element does not define, engage, or clear a baseline grid.

<dt>none

<dd>the element clears the baseline grid

<dt>new

<dd>the element defines and engages a new baseline grid for its content. The new baseline grid is defined by establishing the first baseline of the element by using the first available font; thereafter the frequency of the baseline grid is equal to the used value of 'line-height'.

<dt>root

<dd>the element enganges the <dfn>root baseline grid</dfn>. The root baseline grid is automatically defined by the root element; the calculation for finding the root baseline grid is the same as for the 'new' value. While the root element defines the root baseline grid, it does not engage it.

<dt>page

<dd>the element engages the <dfn>page baseline grid</dfn>. The page baseline grid is automaticalle defined by the page box on the current page and the font properties of the root element; the calculation for finding the page baseline grid is the same as for the root baseline grid, except that the page box is used to position the baseline grid. In continous media, this value is the same as 'root'.

</dl>


<div class=example>
<p>In this example, the <code>article</code> element defines an enganges a baseline grid. Content inside the article will align with the baseline grid, except for headlines and figures.

<pre>
article { baseline-grid: new }
h1, h2, figure { baseline-grid: none }
</pre>

<p>One possible rendition is:

<div style="position: relative; height: 260px; ">
<div style="white-space: pre; color: orange; position: absolute; background: #eee; width: 280px">
     ____________________________
     ____________________________
     ____________________________
     ____________________________
     ____________________________
     ____________________________
     ____________________________
     ____________________________
     ____________________________

</div>
<div style="white-space: pre; position: absolute; top: 3px; left: 23px">
Abc def ghi j
klmn o pqrst
uvw xyz.
</div>

<div style="white-space: pre; position: absolute; top: 70px; left: 23px; font-size: 1.4em; font-weight: bold">
Heading
</div>

<div style="white-space: pre; position: absolute; top: 118px; left: 23px">
Abc def ghi j
klmn o pqrst
uvw xyz. Abc
de fghij klm
</div>

<div style="white-space: pre; position: absolute; top: 3px; left: 153px">
nop q rstuw
xyz.
</div>

<div style="position: absolute; top: 85px; left: 153px; width: 95px; height: 88px; background: black; opacity: 0.5">
</div>
<div style="position: absolute; top: 90px; left: 158px; width: 85px; height: 40px; background: red; opacity: 0.5"></div>

<div style="position: absolute; top: 133px; left: 158px; width: 95px; font-size: 0.9em; font-style: italic; color: white">figure<br>caption
</div>

<div style="white-space: pre; position: absolute; top: 165px; left: 153px">
Abc def ghij
klm nop.
</div>

</div>

<p>Notice how the body text aligns with the baseline grid (shown in orange for illustration purposes), while the heading, figure and figure caption do not. After the heading and figure, the main text starts again on the next available baseline.
</div>




<div class=example>
<p>In this example there are sidenotes in different scripts:

<pre>
aside { font: 12pt serif; baseline-grid: new }
[lang=ar] { font: 10pt 'Amiri', serif }

&lt;aside>&lt;span lang=en>...&lt;/span>&lt;/aside>
...
&lt;aside>&lt;span lang=ar>...&lt;/span>&lt;/aside>
</pre>

<p>The &lt;aside> elements establish a baseline grid from the used font (<code>font: 12pt serif</code>). Content inside the &lt;aside> elements, even in different scripts, fonts and sizes, align with the baseline grid established by the &lt;aside> elements.

</div>

<div class=example>

<p>The root baseling grid is automatically defined, but is not automatically engaged. In this example, the root baseline grid is enganged by the root element.

<pre>
:root { baseline-grid: root }
<pre>
</pre>
</div>


<div class=example>
<p>The root baseline grid is handy when only a few elements want to opt-in to use a baseline grid.

<pre>
p, li, blockquote { baseline-grid: root }
<pre>
</pre>
</div>


<div class=example>

<p>The 'page' baseline grid is automatically defined so that pages with different page margins still can align content to to the same baseline grid. In this example, the 'page' basedline grid is applied to all sidenotes:

<pre>
aside { baseline-grid: page }
<pre>
</pre>
</div>



<h3>'baseline-block-snap'</h3>

<table class=propdef>
    <tr>
      <td><em>Name:</em>
      <td><dfn>baseline-block-snap</dfn>
    <tr>
      <td><em>Value:</em>
    <td>[before | after | center | auto] || [margin-box | border-box]
    <tr>
      <td><em>Initial:</em>
      <td>auto
    <tr>
      <td><em>Applies to:</em>
      <td>elements with 'baseline-grid: new' or 'baseline-grid: none'
    <tr>
      <td><em>Inherited:</em>
      <td>no
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>specified value
</table>

<p>This property describes how to align content that is not aligned to a baseline grid. Values are:

<dl>
<dt>auto
<dd>same as 'before' on top of column, same as 'after' at bottom of column, otherwise 'center'
<dt>before
<dd>the element is placed as close to the previous content as possible
<dt>after
<dd>the element is placed as close to the following content as possible
<dt>center
<dd>the element is centered between the previous and following content.

<dt>margin-box
<dd>the margin edge is used to align the block on the baseline grid
<dt>border-box
<dd>the border edge is used to align the block on the baseline grid
</dl>


<div class=example>

<p>In this example, elements that do not follow the baseline grid will snap upwards towards their older siblings.

<pre>
h2, h2, figure {
  baseline-block-snap: before;
}
</pre>


<div style="position: relative; height: 260px; ">
<div style="white-space: pre; color: orange; position: absolute; background: #eee; width: 280px">
     ____________________________
     ____________________________
     ____________________________
     ____________________________
     ____________________________
     ____________________________
     ____________________________
     ____________________________
     ____________________________

</div>
<div style="white-space: pre; position: absolute; top: 3px; left: 23px">
Abc def ghi j
klmn o pqrst
uvw xyz.
</div>

<div style="white-space: pre; position: absolute; top: 60px; left: 23px; font-size: 1.4em; font-weight: bold">
Heading
</div>

<div style="white-space: pre; position: absolute; top: 118px; left: 23px">
Abc def ghi j
klmn o pqrst
uvw xyz. Abc
de fghij klm
</div>

<div style="white-space: pre; position: absolute; top: 3px; left: 153px">
nop q rstuw
xyz.
</div>

<div style="position: absolute; top: 75px; left: 153px; width: 95px; height: 88px; background: black; opacity: 0.5">
</div>
<div style="position: absolute; top: 81px; left: 158px; width: 85px; height: 40px; background: red; opacity: 0.5"></div>

<div style="position: absolute; top: 124px; left: 158px; width: 95px; font-size: 0.9em; font-style: italic; color: white">figure<br>caption
</div>

<div style="white-space: pre; position: absolute; top: 165px; left: 153px">
Abc def ghij
klm nop.
</div>

</div>
</div>

<!--
<h3>'line-rhythm-reference'</h3>

<table class=propdef>
    <tr>
      <td><em>Name:</em>
      <td><dfn>line-rhythm-reference</dfn>
    <tr>
      <td><em>Value:</em>
    <td>content-box | margin-box | border-box
    <tr>
      <td><em>Initial:</em>
      <td>content-box
    <tr>
      <td><em>Applies to:</em>
      <td>block containers
    <tr>
      <td><em>Inherited:</em>
      <td>no
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>specified value
</table>

<p>When snapping an element

<p>Values are:
<dl>
<dt>content-box
<dd>The content edge is snapped to the nearest grid line.
<dt>margin-box
<dd>The margin edge is snapped to the nearest grid line.
<dt>border-box
<dd>The border edge is snapped to the nearest grid line.
</dl>
-->


<!--
<h2>Extending the box model</h2>

<h3>'box-edge'</h3>

<table class=propdef>
    <tr>
      <td><em>Name:</em>
      <td><dfn>box-edge</dfn>
    <tr>
      <td><em>Value:</em>
    <td>half-leading | em-box
    <tr>
      <td><em>Initial:</em>
      <td>half-leading
    <tr>
      <td><em>Applies to:</em>
      <td>block elements
    <tr>
      <td><em>Inherited:</em>
      <td>no
    <tr>
      <td><em>Percentages:</em>
      <td>N/A
    <tr>
      <td><em>Computed&nbsp;value:</em>
      <td>specified value
</table>

<p>This property describes whether the half-leading is shown at the top/bottom of columns/pages. Values are:


<dl>
<dt>half-leading
<dd>the half-leading is calculated as per <a href="http://www.w3.org/TR/CSS2/visudet.html#leading">CSS 2.1 section 10.8.1</a>
<dt>em-box
<dd>half-leading is not added before the first line and after the last line of boxes generated by the element
</dl>
-->
<!--
<div class=example>
<p>In this example, the root element establishes a line rhythm,

<pre>
:root {
  box-edge: em-box;
  line-rhythm: root;
}
</pre>
</div>
-->
<!--
<div class=example>
<p>In thix example, the half-leading is removed from the top and bottom of boxes belonging to a &lt;p&gt; element.

<pre>
p { box-edge: em-box }

&lt;p&gt;Hello, world.&lt;/p&gt;
</pre>
</div>

<p>This property only has effect when set on the youngest block-level element.

<div class=example>
<p>In this example, the half-leading is not removed from the top and bottom of boxes belonging to a &lt;p&gt; element.

<pre>
div { box-edge: em-box }

&lt;div&gt;
  &lt;p&gt;Hello, world.&lt;/p&gt;
&lt;/div&gt;
</pre>
</div>


-->

<!--

<p class="note">This issue has also been <a href="http://lists.w3.org/Archives/Public/www-style/2009Jan/0010.html">discussed in the past</a>.


<h3>Idea 1</h3>

<p>One possible solution can be found in <a href="http://www.w3.org/TR/css3-linebox/#line-stacking-strategy">CSS3 module: line</a>.

<div class=example>
<pre>
article {
  columns: 3;
  line-stacking-strategy: grid-height;
}
</pre>
</div>

<p>When <code>line-stacking-strategy</code> is set to <code>grid-height</code>, the stack height of each line is the smallest multiple of the element's <code>line-height</code> computed value that can contain the block progression of all the inline elements on that line when those elements are properly aligned. The 'line-height' property value is ignored for inline elements.

<h3>Idea 2</h3>

<p>Another possible solution is to say:

<ol>
<li>For each block-level element, find the "natural" set of baselines given by the computed value of 'line-height' and the used font.
<li>When baseline alignment in turned on, each line is placed on the closest "natural" baseline.
</ol>

<p>This could be achived with:

<div class=example>
<pre>
article {
  columns: 3;
  line-stacking-strategy: baseline-alignment;
}
</pre>
</div>


<h3>Idea 3</h3>

<p>One problem with both Idea 1 and Idea 2 is that all content is aligned. This may not be desireable in all cases. For example, a headline will typically use a larger font size and if all lines in the headline are aligned with a "natural" baseline (or something similar), lots of white space will be generated. Therefore, we need a way to turn off baseline alignment for certain elements.

<div class=example>

<p>In this example, the <code>article</code> element defines a set baselines to be used by its own content as well as its child elements. Child elements can opt out of the scheme by setting <code>line-stacking: normal</code> (or something):

<pre>
article {
  columns: 3;
  line-stacking: set-baselines;
}
article p { line-stacking: use-baselines }
article h1 { line-stacking: normal }
article img { display: block; vertical-align: bottom }
</pre>

<p>(In the code above, the 'vertical-align' property is used to declare where any extra space ends up; in this example it will end up above the image.)
</div>

<h3>Idea 4</h3>

<p>It may be possible to automatically determine which content should be excempted from baseline alignment by looking at the computed value of 'line-height'; if it matches that of the containing block, baseline alignment is turned on, otherwise it's off.

</div>

<h3>Idea 5</h3>

<p><a href="http://dev.w3.org/csswg/css-line-grid">CSS Line Grid Module</a>

<pre>
html { baseline-grid: root }
article { baseline-grid:
p { baseline-grid: root }
img { baseline-grid: none }


article {
  line-grid: root;

}
p {
  line-snap: baseline
}
h1 {
  line-grid:

</pre>

-->

<!--
<p class=note>A similar idea &mdash; 'line-stacking-strategy: grid-height' &mdash; was proposed in a <a href="http://www.w3.org/TR/css3-linebox/#line-stacking-strategy">previous version of the CSS3 line module</a>. The 'line-stacking-strategy' property is <a href="http://www.w3.org/TR/xsl/#line-stacking-strategy">used in XSL</a>.
-->


<!--
<p>In multi-column layouts, baselines are typically aligned between
adjacent columns. This gives the presentation a visual rythm, and text
in the end of the columns will be alignend. To support this, a new
value on the <span class=property>'line-box-contain'</span> property is
defined: ''line-grid'' (or, perhaps, ''gap'', ''crack'', ''snap'', ''snap-gap'', ''void'', ''grid'', ''snap-to-grid'').

<p>The value means that the height of the line in which the element
occurs should be rounded up to the smallest multiple of the used
'line-height' value on the containing block.

<div class=example>
<p>In this example, the stacking height of div.figure would be 30px (2 * 15px)

<pre>
div.multicol { line-height: 15px }
div.figure { height: 20px; line-box-contain: block inline replaced line-grid }
</pre>
</div>
-->
<!--
<p class=note>The <a href="http://dev.w3.org/csswg/css3-linebox/#LineStacking">line-box-contain</a> property is defined in <a href="http://dev.w3.org/csswg/css3-linebox">CSS3 module: line</a>.
-->
<!--
http://www.w3.org/Style/Group/css3-src/css3-linebox/Overview.html#LineStacking
-->

<h2>Character substitution</h2>

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/named-strings.html">html</a>
<a class=pass href="http://www.wiumlie.no/howcome/2014/tests/books/named-strings-ah.pdf">AntennaHouse</a>
<a class=almost href="http://www.wiumlie.no/2014/tests/books/named-strings-pr.pdf">Prince</a>
</div>

<p>It is sometimes convenient to replace one character or string with another without changing the source document. The ‘text-replace’ property offers a way to perform the replacement in the style sheet.

<table class=propdef>
<tr>
  <td><em>Name:</em>
  <td><dfn id=text-replace>text-replace</dfn>

<tr>
  <td><em>Value:</em>
  <td> [&lt;string> &lt;string>]+ | none

<tr>
  <td><em>Initial:</em>
  <td>none

<tr>
  <td><em>Applies to:</em>
  <td>all elements

<tr>
  <td><em>Inherited:</em>
  <td>yes

<tr>
  <td><em>Percentages:</em>
  <td>N/A

<tr>
  <td><em>Media:</em>
  <td>visual

<tr>
  <td><em>Computed&nbsp;value:</em>
  <td>as specified value
</table>

<p>This property replaces all occurrences of a certain string with another string in the content of the element. The property accepts pairs of strings as value, in addition to the initial 'none' value. For each pair of strings, occurrences of the first string in the content will be replaced with the second string. If 'none' is specified, no replacements will occur.

<div class=code-example>
<a href="http://www.wiumlie.no/2014/tests/books/e-character-substitution-motivational.html">html</a>
<a class=fail href="http://www.wiumlie.no/2014/tests/books/e-character-substitution-motivational-ah.pdf">AntennaHouse</a>
<a class=pass href="http://www.wiumlie.no/2014/tests/books/e-character-substitution-motivational-pr.pdf">Prince</a>
</div>

<div class=example>
<p>In this example, three consecutive period characters are replaced with an ellipsis character and the apostrophe character is replaced with a quotation character:

<pre>
body { text-replace: "..." "\2026" "'" "\2019" }
</pre>

<p>As a result, the string "It's the beginning...!" will be changed to "It&#x2019;s the beginning&#x2026;!".
</div>

<div class=example>
<p>In this example, a narrow no-break space is added before exclamation marks in French texts. This is known as "quart de cadratin" in French.

<pre>
html:lang(fr) { text-replace "!" "\202F!" }
</pre>

<p>As a result, the string "Mais, oui!" is changed to "Mais, oui&#x202F;!".

</div>

<div class=example>
<p>In this example, a <em>hair space</em> is added before and after em-dashes.

<pre>
body { text-replace: "—" "\200A—\200A" }
</pre>

<p>As a result, this string "no&mdash;not yet" is changed to "no&#x200A;&mdash;&#x200A;not yet".
</div>



<!--
<div class=example>
<p>In this example, all references to &rsquo;Soviet Union' are replaced with &lsquo;<span class=property>Russia</span>&rsquo;.

<pre>
body { text-replace: "Soviet Union" "Russia" }
</pre>
</div>
-->

<p>Text replacements are applied serially; the first pair of strings is applied to the textual content of the element, then the second pair of strings is applied to the outcome etc.

<div class=example>

<p>The two rules below yield the same result. In the first rule all 'a' characters are converted to 'b'. Subsequently, all 'b' characters are converted to 'c'. In the second rule, all 'a' and 'b' characters are converted directly to 'c'.

<pre>
body { text-replace: "a" "b" "b" "c" }
body { text-replace: "a" "c" "b" "c" }
</pre>
</div>

<p>The first string in a pair must have at least one character, while the second may be empty.

<div class=example>
<p>In this example, all 'a' characters are removed.

<pre>
body { text-replace: "a" "" }
</pre>
</div>

<p>If the first string of a pair is empty, or if an odd number of strings has been specified, the whole value is ignored and no text replacements are performed. Text replacements do not occur across element boundaries.

<div class=example>
<p>No text replacement will occur in this example:

<pre>
h1 { text-replace: "foo" "bar" "" "foo" }   /* ignore value */
h2 { text-replace: "foo" "bar" "foobar" }   /* ignore value */
h3 { text-replace: "foobar" "barfoo" }      /* accept value, but ... */

&lt;h3>foo&lt;span>bar&lt;/span>&lt;/h3>    &lt;!-- ... start tag breaks string which would otherwise match -->
</pre>
</div>

<p>This property is evaluated after the <span class=property>content</span> property, and before <span class=property>text-transform</span>.

<h2>Microtypography</h2>

<p>Microtypography is a range of methods for improving the appearance of text. Often, small adjustments in the space between letters and words can achieve a more even presentation with less need for hyphenation and fewer widows and orphans. This specification extends two existing CSS properties &mdash; 'letter-spacing' and 'word-spacing' &mdash; with minimum and maximum values to guide User Agents when laying out text.

<h3>Minimum, maximum and optimal spacing</h3>


<p>The 'letter-spacing' and 'word-spacing' properties are extended to accept up to three values:

<pre>
  [ normal | &lt;length> | &lt;percentage>]{1,3}
</pre>
<!-- [ normal | &lt;length> ]{1,3}-->


<p>Values are:

<dl>
<dt>normal

<dd>The spacing is the normal spacing for the current font. This value allows the user agent to alter the space between characters in order to justify text.

<dt>&lt;length>
<dd>Specifies extra spacing in addition to the default space between characters and words. Values may be negative, but there may be implementation-specific limits.

<dt>&lt;percentage>
<dd>Relative to width of space character.

<dd>

<p>If one value is specified, it describes the optimum value, as well as the minimum and maximum values. If two values are specified, the first denotes the optimum and the minimum, and the second denotes the maximum. If three values are specified, they describe the optimum, minimum and maximum values.

</dl>

<!--<p>The values themselves are described in <a href="http://www.w3.org/TR/css-text-3/#spacing">CSS Text</a>.-->

<div class=example>
<pre>
p {
  letter-spacing: -0.04em 0 0.04em;
  word-spacing: -0.2em normal 0.2em;
}
</pre>
</div>


<div class=issue>
<p>What are min/max values relative to? Are they relative to the
normal position (like the opt values are), or to the opt position?
</div>

<div class=issue>
<p>If we add percentage values, what are they relative to? Something other than em? CSS3 Text suggested advance measure/width for word-spacing, which probably means the space character?

<pre>
letter-spacing: -5% 0% 5%;
letter-spacing: -5% 0% 5%;

word-spacing: 80% 100% 120%;
word-spacing: 80% 100% 120%;
</pre>
</div>


<div class=issue>
<p>Would it be better to only use positive numbers? Like this:
<pre>
p {
  letter-spacing: 0.04em 0 0.05em;
  word-spacing: 0.2em normal 0.2em;
}
</pre>
<p>If so, one could often just use two values::
<pre>
p {
  letter-spacing: 0 0.05em;
  word-spacing: normal 0.2em;
}
</pre>

</div>

<h2>Spatial layout of pages; @layout</h2>

<p>In commonly used apps, pages are often laid out spatially so that
users can nagivate from one page to another by moving up, down, right
or left. To support this feature for web content, a new @-rule is
proposed: @layout. The purpose of @layout is to describe how pages are
laid out spatially relative to the current document.

<p>Four new properties are allowed inside @layout: nav-up, nav-right, nav-bottom, nav-right.

<p class=note>The name of the properties inside @layout are borrowed from <a href="http://www.w3.org/TR/2004/CR-css3-ui-20040511/#nav-dir">CSS3 Basic User Interface Module</a>.

<p>The properties accept these values:

<dl>

<dt>go()

<dd>the function takes one argument, which refers to the <tt>rel</tt> attribute of the <tt>link</tt> element

<div class=example>
<pre>
&lt;link rel=index href="../index.html">
&lt;link rel=previous href=g3.html>
&lt;link rel=next href=g1.html>
...

@layout {
  nav-up: go(index);
  nav-left: go(previous);
  nav-right: go(next);
}
</pre>
</div>

<p class=issue>This functionality relies on semantics in HTML and CSS. Other languages may have other other ways to describe such semantics. One possible solution for other languages is  "link[rel=index] { nav-up: attr(href) }"

<dt>''back''

<dd>The keyword takes the user one step back in the history of browsed pages.

<div class=example>
<pre>
@layout {
  nav-left: back;
}
</pre>
</div>

<dt>url()

<dd>The funcation takes one argument: a URL. Relative URLs are
relative to the style sheet.

<div class=example>
<pre>
@layout {
  nav-up: url(..);
  nav-down: url(a1.html);
}
</pre>
</div>

<dt>url-doc()

<dd>The function is identical to url(), except that relative URLs are
relative to the document, not to the style sheet.

<div class=example>
<pre>
@layout {
  nav-up: url-doc(..);
  nav-down: url-doc(a1.html);
}
</pre>
</div>

</dl>



<div class=example>

<p>Combined with the <a href="http://www.w3.org/TR/2011/WD-css3-conditional-20110901/#at-document">@document-rule</a>, navigation maps can be described:

<pre>
@document url("http://example.com/foo") {
  @layout {
    nav-right: link-rel(next);
  }
}

@document url("http://example.com/bar") {
  @layout {
    nav-up: link-rel(next);
  }
}
</pre>

</div>

<p class=issue>alternative name: @navigation, @neighborhood, @hood</p>

<h3>Page shift effects</h3>

<p>To describe page shift effects, four new properties inside
@layout are proposed: nav-up-shift, nav-right-shift,
nav-down-shift, nav-left-shift. These properties take one of several
keyword values:

<dl>

<dt>pan
<dd>pans to the new page; this is the initial value

<dt>turn
<dd>turns the page, like soft book pages do

<dt>flip
<dd>flips the page, like stiff cardbord

<dt>fold
<dd>the old page folds, like an accordion

</dl>

<p class=issue>The proposed keyword values are loosely described. Are
there better ways to describe transitions?

<div class=example>
<pre>
@layout {
   nav-up-shift: pan;
   nav-down-shift: flip;
}
</pre>
</div>



<!--
<h2>Conditional text</h2>

<div class=example>
<pre>
a:target-layout(attr(href url), same-page) { content: " on this page" }
a:target-layout(attr(href url), next-page) { content: " on the next page" }
a:target-layout(attr(href url), previous-page) { content: " on the previous page" }
</pre>
</div>
-->

<h2>Appendix A: Default style sheet</h2>

<pre>
@page {
  counter-reset: footnote;
  @footnote {
    counter-increment: footnote;
    float: bottom;
    column-span: all;
    height: auto;
  }
}

::footnote-call {
  counter-increment: footnote;
  content: counter(footnote, super-decimal);
}
::footnote-marker {
  content: counter(footnote, super-decimal);
}

h1 { bookmark-level: 1 }
h2 { bookmark-level: 2 }
h3 { bookmark-level: 3 }
h4 { bookmark-level: 4 }
h5 { bookmark-level: 5 }
h6 { bookmark-level: 6 }
</pre>

<h2 class=no-num>References</h2>

<div id=anolis-references></div>


<h2 class=no-num id=acknowledgments>Acknowledgments</h2>

<p>This document has been improved by Bert Bos, Michael Day, Melinda
Grant, David Baron, Markus Mielke, Steve Zilles, Ian Hickson, Elika
Etemad, Laurens Holst, Mike Bremford, Allan Sandfeld Jensen, Kelly
Miller, Werner Donn&eacute;, Tarquin (Mark) Wilton-Jones, Michel Fortin,
Christian Roth, Brady Duga, Del Merritt, Ladd Van Tol, Tab Atkins Jr.,
Jacob Grundtvig Refstrup,  James Elmore, Ian Tindale, Murakami Shinyu, Paul E.
Merrell, Philip Taylor, Brad Kemper, Peter Linss, Daniel Glazman, Tantek &#xC7;elik, Florian Rivoal, Alex Mogilevsky, Simon Sapin, Cameron McCormack, Liam R E Quin, Peter Moulder, Morten Stenshorne, Rune Lillesveen, Lars Erik Bolstad, Anton Prowse, Michel Onoff, Dave Cramer.</p>

</html>
